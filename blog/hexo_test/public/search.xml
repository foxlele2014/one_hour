<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>远程桌面服务搭建</title>
      <link href="/one_hour/2025/01/20/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%B9%8Bvnc%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
      <url>/one_hour/2025/01/20/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%B9%8Bvnc%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<ul><li>novnc</li><li>guacamole</li></ul><h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>VNC 是远程桌面协议家族（RFB），常用服务端有 TigerVNC、x11vnc 等。noVNC 提供基于 Web 的 VNC 客户端（通过 WebSocket + canvas），Guacamole 是一个更完整的网关，支持 VNC&#x2F;RDP&#x2F;SSH 并提供 Web 界面与认证后端（可用 Docker 部署）。</p><h3 id="常见方案对比"><a href="#常见方案对比" class="headerlink" title="常见方案对比"></a>常见方案对比</h3><ul><li>noVNC：轻量、直接把 VNC 流量通过 websockify 转成 WebSocket，适合需要快速在浏览器打开远程桌面的场景。</li><li>Guacamole：企业级网关，支持多协议、认证、会话管理、录制&#x2F;剪贴板&#x2F;文件传输（通过扩展），适合集中化接入。</li></ul><h3 id="Ubuntu-上的快速示例（最小化）"><a href="#Ubuntu-上的快速示例（最小化）" class="headerlink" title="Ubuntu 上的快速示例（最小化）"></a>Ubuntu 上的快速示例（最小化）</h3><ol><li>安装 VNC 服务（TigerVNC）并创建用户桌面：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y tigervnc-standalone-server xfce4</span><br><span class="line"><span class="comment"># 为用户设置 vnc 密码</span></span><br><span class="line">vncpasswd</span><br><span class="line"><span class="comment"># 启动（示例）：</span></span><br><span class="line">vncserver :1 -geometry 1280x800 -depth 24</span><br></pre></td></tr></table></figure></li><li>使用 noVNC（websockify）暴露到浏览器：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 noVNC (示例)</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/novnc/noVNC.git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/novnc/websockify.git noVNC/utils/websockify</span><br><span class="line"><span class="comment"># 启动 noVNC，连接到本地 VNC :1（5901）</span></span><br><span class="line">./noVNC/utils/novnc_proxy --vnc localhost:5901 --listen 6080</span><br><span class="line"><span class="comment"># 然后在浏览器访问 http://server:6080/vnc.html</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="Guacamole（推荐用-Docker-快速部署）"><a href="#Guacamole（推荐用-Docker-快速部署）" class="headerlink" title="Guacamole（推荐用 Docker 快速部署）"></a>Guacamole（推荐用 Docker 快速部署）</h3><p>使用官方 Docker 镜像和 MySQL&#x2F;Postgres 后端的最小 docker-compose 示例（省略持久化&#x2F;细节）：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">guacd:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">guacamole/guacd</span></span><br><span class="line">  <span class="attr">guacamole:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">guacamole/guacamole</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">guacd</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_HOSTNAME:</span> <span class="string">db</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">guacamole_db</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">guacamole_user</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">secret</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">rootpw</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">guacamole_db</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">guacamole_user</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure><p>启动后访问 guacamole 容器提供的 web 界面，配置 VNC 连接并启用用户&#x2F;权限。</p><h3 id="安全与运维要点"><a href="#安全与运维要点" class="headerlink" title="安全与运维要点"></a>安全与运维要点</h3><ul><li>永远为 VNC 连接设置强密码；默认 VNC 协议无加密，建议通过 TLS 或 SSH 隧道转发 VNC（或使用 noVNC + nginx TLS 反向代理）。</li><li>若使用 noVNC，使用 websockify 的 TLS 或在前端用 Nginx&#x2F;Traefik 做 HTTPS 终端并限制访问（认证&#x2F;防火墙）。</li><li>Guacamole 提供认证与会话控制，但仍需放在 HTTPS 和受限网络后面；为 Guacamole 数据库启用备份与最小权限用户。</li><li>防火墙：仅开放必要端口（如 6080&#x2F;8443 给 Web，VNC 原生端口建议仅内部可达）。</li><li>性能：降低色深、启用压缩、调整分辨率可改善带宽占用；HTTP&#x2F;2&#x2F;3&#x2F;负载均衡用于大规模访问场景。</li></ul><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul><li>简单场景：TigerVNC + noVNC 快速可用，适合临时或轻量化需求。</li><li>企业&#x2F;集中管理：Guacamole 更完整，支持多协议与认证&#x2F;审计。</li><li>部署时优先考虑加密（HTTPS&#x2F;TLS&#x2F;SSH 隧道）、认证与防火墙策略，并在生产环境使用持久化存储与监控。</li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>novnc使用虚拟机来建立多账号访问的时候，会很卡。<br>但是guacamole创建的服务，可以在一台电脑上，创建多个账号，使用rdp协议来达到同时可以多个人使用不同账号连接这台电脑使用服务。</p><p>TODO:具体的细节之后再分享。</p><p>（背景：需求：通过网页输入链接来达到访问某台服务器的服务，而且支持多账号访问同一个服务器的不同服务。且最好能使用一台电脑就能做这个事情。<br>之后一开始我接手的时候，他们定好了要使用novnc来实现。且他们使用创建多个虚拟机+novnc来访问，但是这样很卡；这期间还做了很多关于novnc进入页面时的自动登录；密码管理，域账号管理等；后来他们觉得novnc的这个方案还是不可行，所以选择了guacamole的方案。但是怎么可以做到访问多个账号呢。就是需要一个应用将windows类似破解一样，让它支持rdp访问支持同时在线。）</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>人生如逆旅，我亦是行人</title>
      <link href="/one_hour/2025/01/13/%E4%BA%BA%E7%94%9F%E5%A6%82%E9%80%86%E6%97%85%EF%BC%8C%E6%88%91%E4%BA%A6%E6%98%AF%E8%A1%8C%E4%BA%BA/"/>
      <url>/one_hour/2025/01/13/%E4%BA%BA%E7%94%9F%E5%A6%82%E9%80%86%E6%97%85%EF%BC%8C%E6%88%91%E4%BA%A6%E6%98%AF%E8%A1%8C%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<p>这句居然是出自《临江仙·送钱穆父》，我居然不知道。（而且ai还告诉我错的信息，太太太离谱了）</p><p>逆旅是旅馆，旅店。</p><p>我：哈哈哈哈哈人生原来就是黑盒游戏，我只是里边的npc<br>AI：哈哈，有趣的类比！让我们延伸一下这个想法：<br>游戏视角：<br>人生 &#x3D; 开放世界游戏</p><ul><li>每个人都是主角</li><li>也都是别人的NPC</li><li>没有攻略和存档</li><li>实时渲染，无法倒带</li></ul><p>NPC的觉醒</p><ul><li>我们都以为自己是主角</li><li>其实也都是别人故事里的配角</li><li>每个NPC都有自己的故事线</li><li>每个人都在演绎自己的剧情</li></ul><p>游戏特点：</p><ul><li>无法预知剧情</li><li>没有存档点</li><li>选择会影响结局</li><li>随机事件很多</li></ul><p>游戏攻略：（这个自动生成居然给我生成一个：没有！！！哈哈哈哈哈它太会了</p><ul><li>享受过程</li><li>善待他人</li><li>保持好奇</li><li>勇于探索</li></ul><p>我： 哈哈哈哈哈你说得对，开放世界，你想把什么当成主线都可以</p><p>游戏特色：<br>自由度MAX：</p><ul><li>随时切换主线</li><li>支线任务无限</li><li>剧情可以重写</li><li>结局由你决定</li></ul><p>游戏提示：</p><ul><li>没有”最佳路线”</li><li>每个选择都有意义</li><li>失败也是游戏内容</li><li>享受探索的过程</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据分析的学习路径</title>
      <link href="/one_hour/2025/01/13/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84/"/>
      <url>/one_hour/2025/01/13/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84/</url>
      
        <content type="html"><![CDATA[<h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h2><ol><li>数据的收集和预处理</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：文本数据处理</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_text</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># 分词</span></span><br><span class="line">    tokens = nltk.word_tokenize(text)</span><br><span class="line">    <span class="comment"># 词性标注</span></span><br><span class="line">    tagged = nltk.pos_tag(tokens)</span><br><span class="line">    <span class="keyword">return</span> tagged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取语料库</span></span><br><span class="line">  data = pd.read_csv(<span class="string">&#x27;corpus.csv&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>语法规则分析</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计语法模式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_patterns</span>(<span class="params">sentences</span>):</span><br><span class="line">    patterns = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> sent <span class="keyword">in</span> sentences:</span><br><span class="line">        <span class="comment"># 例如：分析 &quot;is + article + noun&quot; 模式</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;is a teacher&quot;</span> <span class="keyword">in</span> sent:</span><br><span class="line">            patterns[<span class="string">&#x27;is_a_noun&#x27;</span>] = patterns.get(<span class="string">&#x27;is_a_noun&#x27;</span>, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> patterns</span><br></pre></td></tr></table></figure><ol start="3"><li>机器学习模型</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本向量化</span></span><br><span class="line">vectorizer = TfidfVectorizer()</span><br><span class="line">X = vectorizer.fit_transform(texts)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练测试集分割</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>常用工具和库：</li></ol><p>数据处理：Pandas, NumPy<br>文本处理：NLTK, SpaCy<br>机器学习：Scikit-learn<br>深度学习：PyTorch, TensorFlow</p><h2 id="数据收集"><a href="#数据收集" class="headerlink" title="数据收集"></a>数据收集</h2><ol><li>网络爬虫采集</li><li>官网开放数据集<br>Common Crawl（网页数据）<br>Wikipedia dumps（维基百科数据）<br>各国政府开放数据平台<br>研究机构发布的语料库</li><li>付费数据服务<br>API 服务<br>数据供应商<br>专业数据平台</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>英语单词记录1</title>
      <link href="/one_hour/2025/01/13/%E8%8B%B1%E8%AF%AD%E5%8D%95%E8%AF%8D%E8%AE%B0%E5%BD%951/"/>
      <url>/one_hour/2025/01/13/%E8%8B%B1%E8%AF%AD%E5%8D%95%E8%AF%8D%E8%AE%B0%E5%BD%951/</url>
      
        <content type="html"><![CDATA[<p>老外常说的I have company是啥意思？<br>01<br> company</p><p>经常看美剧的同学一定遇到过一句台词：<br>I have company.</p><p>这是啥意思？我有一家公司吗？</p><p>这么理解的话就大错特错了。<br>company 作「公司」讲时，是可数名词。<br>而可数名词不能裸奔，使用时前面要么加上a &#x2F; an &#x2F; the或物主代词（比如my），要么后面加s，以复数形式出现。</p><p>因此「我有公司」的正确写法是：I have a company. 或者 I have companies.</p><p>而I have company 中的company 是不可数名词。</p><p>company 作不可数名词时，是「陪伴」的意思。<br>图片<br>I have company 直译就是：我有陪伴了。<br>说人话就是：我有人陪。我有客人。</p><p>我们来看两个美剧里的例子：图片Would you put on some pants? We have company.<br>图片Now? You want to come over now? You have company.<br>我把《绝望的主妇》这个片段剪辑下来，大家看一看~<br>再比如《经济学人》一篇关于老龄化的文章有这样一句话：<br>Nearly half of Britons over the age of 65 say that television or pets are their main form of company.<br>近一半65岁以上的英国人称陪伴自己最多的是电视机或宠物。<br>很多同学经常问我：明明文章都读懂了，为什么还是做不对题？<br>但如果你回头仔细精读原文，就会发现，99%的情况都是——你误以为自己读懂了文章，但其实很多细节都完全理解错了。<br>其中，最容易出错的地方之一就是「熟词僻义」或者说「一词多义」。 </p><p>一些看似简单的词有着你完全陌生的意思，一旦理解错，整个句子就变得不知所云。</p><p>因此，我们在积累单词的时候，不仅要追求词汇的广度，也要关注词汇的深度，要把高频词的常见意思都记一记，而且要放在语境里去记忆。<br>我们再回到company这个词：<br>company 作此义讲时，还有几个高频搭配：<br>enjoy one’s company 喜欢某人的陪伴，喜欢和某人在一起<br>keep sb’s company 陪伴某人<br>in the company of sb 和某人在一起，相当于with sb。</p><p>再提醒一下大家，背单词要以词组为单位，不要一个词一个词去记，而是要一个词组、一个词组去记。</p><p>背单词的时候就要把一个词常见的搭配（尤其是介词搭配）都记一记、有个印象，放在语境里才能快速识别出来。</p><p>我们来看几个例句：<br>I felt nervous in the company of such an important man.<br>和这么一个重要人物在一起我感到很不自在。<br>图片Did you tell Clara that you enjoyed the dog’s company more than hers?<br>图片And I was wondering if you’d like to keep her company this evening?</p><p>再分享一句我很喜欢的台词：<br>图片You can never be lonely with the company of a good book.</p><p>再给同学们讲一讲它的同根词，大家串联起来一起记忆，事半功倍：</p><p>02<br> companion</p><p>companion [kəmˈpænjən] 为可数名词，指「同伴，伴侣」(someone you spend a lot of time with, especially a friend)，有时候可以替换friend。<br>举个BBC版《小妇人》里的例子：<br>图片And she says that she needs a companion for her daughter Florence.<br>图片<br>Almost as soon as I entered the house, I singled you out as the companion of my future life.</p><p>我们在可爱又心酸，做纸板狗的中国大学生 | 外媒说里也遇见过这个词：<br>In an attempt to ease their woes, students across the nation have begun making handicraft animal companions out of recycled cardboard.<br>为排解苦闷，全国各地的大学生开始利用废纸箱，制作手工宠物玩伴。</p><p>考研英语2005年Text 1的一个选项里也出现过这个词：<br>图片<br>[D] more generous than their male companions.比她们的雄性同伴更慷慨</p><p>03<br> companionship</p><p>companionship [kəmˈpænjənʃɪp] 为不可数名词，指「友谊，情谊」(Companionship is having someone you know and like with you, rather than being on your own)。</p><p>与company相比，companionship 描述人与人之间更深层次的情感纽带，比如家人、朋友、恋人间的关系。</p><p>而 company 既可以指家人、朋友、恋人的陪伴，也可以指临时的陪伴。</p><p>我们来看几个英美剧里的例子，体会一下：<br>图片Look, all I am saying is (that) wanting companionship is not shameful.<br>图片<br>You live alone, Mr Knightley and I do not think it possible for a man to appreciate how much a woman needs the companionship of another woman. Emma will miss company dreadfully.<br>我们在缅北诈骗集团猖獗，外媒如何报道？也遇见过这个词：<br>The financial victims of the online scams, which revolve around illusory promises of love and companionship, are global.<br>这些网络骗局的受害者遍布全球。骗子会假装与受害人交朋友、谈恋爱，然后再进行诈骗。</p><p>考研英语二2015年 Part B也考过这个词：<br>You may have a circle of friends who provide constant good humor, help and companionship.<br>你身边可能有一个朋友圈子，给你持续提供好心情，帮助以及陪伴。</p><p>04<br> accompany</p><p>accompany [əˈkʌmpəni] 为动词，后面跟人时，指「陪伴某人」，跟物时，指「伴随，与…同时发生」。<br>比如《经济学人》一篇关于医疗技术的文章有这样一句话：<br>As with all new technologies, pitfalls accompany the promise.<br>和所有的新技术一样，陷阱总是与希望相伴而来。</p><p>这句话可以背下来，用来作为论述科技的好处到科技的坏处的过渡句。<br>图片I had DJ very young, so as a child, she always accompanied me on the road.<br>图片<br>Aunt March is very ill, so Laurie will accompany them.</p><p>关于accompany 还有一个高频句式：<br>A，accompanied with &#x2F; by B, does sth. 表示「A，加上B，如何如何」。注意谓语动词的单复数由主语A决定。<br>比如《经济学人》一篇关于中国人口下降的文章有这样一句话：<br>This relaxation—accompanied by a slew of incentives to have children, ranging from cash handouts to tax breaks and longer maternity leave—has had little impact.<br>和政策一同到来的还有现金补贴、减税、产假延长等一系列生娃激励举措。但几乎并未溅起什么水花。<br>我们在第5季还讲过一系列类似的表达，大家顺便复习一下：<br>A, coupled with B, does sth.<br>A, combined with B, does sth.<br>A, paired with B, does sth.</p><p>accompany sb 还可以指「为…伴奏」。<br>图片Edie is going to accompany me on guitar.<br>图片Not exactly. I am accompanying the first graders.</p><p>05<br> accompanying</p><p>accompanying [əˈkʌmpəniɪŋ] 是个形容词，指「随之而来的，附带的」。</p><p>我们来看个剑桥雅思7里的例子：<br>The road improvements and accompanying maintenance system had helped make the district centre accessible throughout the year.<br>道路状况的改善以及配套的道路养护制度已经使得人们全年都可到达地区中心。<br>再来看两个考研英语里的例子：<br>Finally, the public （including other scientists） receives the new discovery and possibly accompanying technology.<br>最后，公众（包括其他科学家）接受这个新发现以及可能随之而来的技术。（考研英语一 2012年 Text 3）<br>Nearly 40% of the roughly 350 people who responded to an accompanying poll said, they had collaborated with artists；and almost all said they would consider doing so in future.<br>在大约350名接受随文所附问卷调查的人中，有近40%的人表示，他们曾与艺术家合作过；而且几乎所有人都表示他们会考虑在未来与艺术家合作。（考研英语一 2022年 Text 3）</p><p>来源：独霸上海的妖怪</p>]]></content>
      
      
      <categories>
          
          <category> 英语 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 英语单词 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>谷歌插件编写</title>
      <link href="/one_hour/2025/01/13/%E8%B0%B7%E6%AD%8C%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/"/>
      <url>/one_hour/2025/01/13/%E8%B0%B7%E6%AD%8C%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/</url>
      
        <content type="html"><![CDATA[<ol><li>配置manifest.json 文件（必需）</li></ol><ul><li>主要是包含基础信息，权限，以及功能组件等</li><li>插件的配置文件</li></ul>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GitHub Issue Creator&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;快速将选中文本添加到 GitHub Issues&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;storage&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;activeTab&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;contextMenus&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;scripting&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;host_permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;all_urls&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>     <span class="comment">// 在哪些页面注入</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;content-styles.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 注入的样式文件</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>   <span class="comment">// 注入的脚本文件</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_end&quot;</span>       <span class="comment">// 在什么时候注入</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icons/icon48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icons/icon128.png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure><ol start="2"><li>popup相关文件（可选， 假如需要点击插件图标弹出页面）</li></ol><ul><li>popup.html 文件：插件的弹出页面</li><li>popup.js 文件：插件的弹出页面逻辑</li></ul><ol start="3"><li>配置background.js 文件（可选）</li></ol><ul><li>插件的背景脚本，用于处理插件的后台逻辑</li><li>可以一直运行在后台</li><li>菜单右键，快捷键等功能处理</li></ul><ol start="4"><li>配置content-script.js 文件（可选，也需要配置到manifest.json 中）</li></ol><ul><li>插件的页面脚本，用于处理插件的页面逻辑</li><li>可以访问页面DOM</li><li>可以访问页面JS API</li></ul><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>manifest.json (配置)<br>    ↓<br>background.js (后台逻辑)<br>    ↓<br>popup.html&#x2F;js (用户界面) ←→ content-script.js (网页交互)</p><h2 id="API-相关"><a href="#API-相关" class="headerlink" title="API 相关"></a>API 相关</h2><ol><li>chrome.storage 类似localStorage， 但是可以跨域， 跨设备， 跨会话（local本地存储，sync同步存储，managed托管存储，大小是100kb，存储操作时异步的）</li><li>chrome.runtime.sendMessage 和 chrome.runtime.onMessage.addListener 用于在插件和后台脚本之间通信（类似Electron渲染进程和主进程）</li><li>chrome.runtime.onInstalled.addListener 用于在插件安装时执行一些操作</li><li>chrome.runtime.onStartup.addListener 用于在插件启动时执行一些操作</li><li>chrome.runtime.onConnect.addListener 用于在插件和后台脚本之间建立连接</li><li>chrome.runtime.onSuspend.addListener 用于在插件休眠时执行一些操作</li><li>chrome.windows.create 用于创建新窗口</li><li>chrome.windows.onClicked.addListener 用于监听新窗口的点击事件</li><li>chrome.contextMenus.create 用于创建右键菜单</li></ol><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><ol><li>安装&#x2F;更新时</li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (details.<span class="property">reason</span> === <span class="string">&#x27;install&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 首次安装时的初始化</span></span><br><span class="line">    <span class="comment">// 例如：创建右键菜单、设置默认配置等</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (details.<span class="property">reason</span> === <span class="string">&#x27;update&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 更新时的处理</span></span><br><span class="line">    <span class="comment">// 例如：迁移旧数据、更新配置等</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>启动时</li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onStartup</span>.<span class="title function_">addListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 启动时的处理</span></span><br><span class="line">  <span class="comment">// 例如：检查更新、恢复状态等</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>激活&#x2F;休眠</li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js 在 Service Worker 模式下</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onSuspend</span>.<span class="title function_">addListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Service Worker 即将被终止时的清理工作</span></span><br><span class="line">  <span class="comment">// 保存状态、清理资源等</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="4"><li>激活的时机</li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下事件会唤醒 Service Worker：</span></span><br><span class="line"><span class="comment">// 1. 扩展安装或更新时</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">details</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker 被安装/更新激活&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 接收到消息时</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">message, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker 被消息激活&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 右键菜单被点击时</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="property">onClicked</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">info, tab</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker 被菜单点击激活&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 浏览器启动时</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onStartup</span>.<span class="title function_">addListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker 被浏览器启动激活&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="github-issue-插件（主要是为了方便我记录一些文字，然后一键创建github-issue）"><a href="#github-issue-插件（主要是为了方便我记录一些文字，然后一键创建github-issue）" class="headerlink" title="github issue 插件（主要是为了方便我记录一些文字，然后一键创建github issue）"></a>github issue 插件（主要是为了方便我记录一些文字，然后一键创建github issue）</h2><ol><li>基础配置</li></ol><p>  manifest.json  (插件配置文件)<br>  ├── 定义插件权限 (permissions)<br>  ├── 注册后台脚本 (background.js)<br>  ├── 定义弹出窗口 (popup.html)<br>  └── 配置图标等基本信息</p><ol start="2"><li>设置功能</li></ol><p>  popup.html (设置界面)<br>  └── popup.js (设置逻辑)<br>      ├── 保存 GitHub Token<br>      ├── 保存仓库所有者<br>      └── 保存仓库名称</p><ol start="2"><li>核心功能</li></ol><p>  background.js (后台脚本)<br>  ├── 创建右键菜单<br>  ├── 处理菜单点击事件<br>  ├── 创建新 Issue 窗口<br>  └── 打开 Issue 选择器窗口</p><ol start="3"><li>创建新issue</li></ol><p>  create-issue.html (创建界面)<br>  └── create-issue.js (创建逻辑)<br>      ├── 加载选中的文本<br>      ├── 设置 Issue 标题<br>      ├── 加载标签列表<br>      └── 提交创建请求</p><ol start="4"><li>添加到已有的issue</li></ol><p>  issue-selector.html (选择界面)<br>  └── issue-selector.js (选择和评论逻辑)<br>      ├── 加载已有 Issues 列表<br>      ├── 搜索过滤功能<br>      ├── 显示评论表单<br>      └── 提交评论请求</p><ol start="5"><li>数据流向</li></ol><p>  选中文本 → background.js → chrome.storage → 功能窗口 → GitHub API</p><p>这个是菜单右键实现的。可以做成那种悬浮在选中文字上边，就出现工具栏的话，就需要用到content-script.js 了。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 谷歌插件 </tag>
            
            <tag> cursor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cron时间格式的记录</title>
      <link href="/one_hour/2025/01/13/cron%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
      <url>/one_hour/2025/01/13/cron%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<ol><li>凌晨3点每天</li></ol><p>┌───────────── 分钟 (0-59)<br>│ ┌───────────── 小时 (0-23)<br>│ │ ┌───────────── 日期 (1-31)<br>│ │ │ ┌───────────── 月份 (1-12)<br>│ │ │ │ ┌───────────── 星期 (0-6) (周日&#x3D;0)<br>│ │ │ │ │<br>0 3 * * *</p><p>第一个 0 表示分钟数为0<br>第二个 3 表示小时数为3<br>第三个 * 表示每天<br>第四个 * 表示每月<br>第五个 * 表示每周的每一天</p>]]></content>
      
      
      <categories>
          
          <category> 时间 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cron </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据作为电信号存储的知识点</title>
      <link href="/one_hour/2025/01/02/%E6%95%B0%E6%8D%AE%E4%BD%9C%E4%B8%BA%E7%94%B5%E4%BF%A1%E5%8F%B7%E5%AD%98%E5%82%A8%E7%9A%84%E7%9F%A5%E8%AF%86/"/>
      <url>/one_hour/2025/01/02/%E6%95%B0%E6%8D%AE%E4%BD%9C%E4%B8%BA%E7%94%B5%E4%BF%A1%E5%8F%B7%E5%AD%98%E5%82%A8%E7%9A%84%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h2 id="数据作为电信号存在哪里"><a href="#数据作为电信号存在哪里" class="headerlink" title="数据作为电信号存在哪里"></a>数据作为电信号存在哪里</h2><ol><li>最基础的存储单元：晶体管和电容器组合<br>  a. 晶体管：能够放大或者控制电流的元器件。三大区域，中间有两个PN结。通过控制一个区域的电压，来达到控制其他两个区域的电流。<br>  b. 电容器：能够存储电荷的元器件。两个电极，中间有一层介质。电容器通电时，电荷会在电极之间的介质积聚。</li><li>内存（RAM）<br>  a. 使用DRAM（动态随机存取存储器）<br>  b. 每个位（bit），由一个晶体管和电容器组成<br>  c. 电容器充电表示1， 放电表示0<br>  d. 需要定期刷新</li><li>怎么定期刷新？<br>  a. DRAM的刷新过程是通过”读取-重写”操作完成的<br>  b. 刷新时，内存控制器会：<ul><li>读取内存单元中的数据</li><li>立即将数据重新写回该单元</li><li>这个过程会重新给电容充电，防止数据丢失<br>  c. 刷新频率通常是每64ms刷新一次<br>  d. 刷新过程是自动进行的，不会影响正常的数据访问</li></ul></li><li>为什么需要定期刷新？</li><li>那假如我一台电脑很久很久不使用，那里边的数据按理论是会丢失的？</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cursor </tag>
            
            <tag> 计算机原理 </tag>
            
            <tag> 计算机基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>debug的各种姿势</title>
      <link href="/one_hour/2018/02/07/debug%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/"/>
      <url>/one_hour/2018/02/07/debug%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/</url>
      
        <content type="html"><![CDATA[<ul><li><input disabled="" type="checkbox"> wireshark</li><li><input disabled="" type="checkbox"> pc端和移动端调试</li><li><input disabled="" type="checkbox"> node调试方法</li></ul><h2 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h2><h3 id="过滤器使用："><a href="#过滤器使用：" class="headerlink" title="过滤器使用："></a>过滤器使用：</h3><p>常用过滤语法：</p><ul><li>ip.addr &#x3D;&#x3D; 192.168.1.1    &#x2F;&#x2F; 指定IP</li><li>tcp.port &#x3D;&#x3D; 80            &#x2F;&#x2F; 指定端口</li><li>http                      &#x2F;&#x2F; HTTP协议</li><li>tcp.flags.syn &#x3D;&#x3D; 1        &#x2F;&#x2F; TCP SYN包</li><li>frame contains “password”  &#x2F;&#x2F; 包含关键字</li></ul><h3 id="抓包技巧"><a href="#抓包技巧" class="headerlink" title="抓包技巧"></a>抓包技巧</h3><p>定位问题：</p><ul><li>使用颜色标记重要数据包</li><li>跟踪TCP流</li><li>查看协议层级</li><li>分析握手过程</li><li>检查重传包</li></ul><h3 id="调试场景"><a href="#调试场景" class="headerlink" title="调试场景"></a>调试场景</h3><ul><li>网络连接问题</li><li>HTTP请求分析</li><li>WebSocket通信</li><li>DNS解析问题</li><li>SSL&#x2F;TLS问题</li></ul><h3 id="实用快捷键"><a href="#实用快捷键" class="headerlink" title="实用快捷键"></a>实用快捷键</h3><p>快捷操作：</p><ul><li>Ctrl + E    &#x2F;&#x2F; 开始&#x2F;停止捕获</li><li>Ctrl + R    &#x2F;&#x2F; 重新开始捕获</li><li>Ctrl + F    &#x2F;&#x2F; 查找</li><li>Ctrl + .    &#x2F;&#x2F; 转到下一个包</li><li>Ctrl + ,    &#x2F;&#x2F; 转到上一个包</li></ul><h3 id="调试建议"><a href="#调试建议" class="headerlink" title="调试建议"></a>调试建议</h3><ul><li>先用过滤器缩小范围</li><li>关注异常状态码</li><li>检查响应时间</li><li>分析错误包</li><li>保存重要捕获</li></ul><h2 id="PC端和移动端调试"><a href="#PC端和移动端调试" class="headerlink" title="PC端和移动端调试"></a>PC端和移动端调试</h2><h3 id="PC-端"><a href="#PC-端" class="headerlink" title="PC 端"></a>PC 端</h3><ol><li>console </li><li>断点</li><li>postman接口测试</li><li>性能分析（performance面板，memory面板）</li></ol><h4 id="Performance面板"><a href="#Performance面板" class="headerlink" title="Performance面板"></a>Performance面板</h4><p>录制步骤：</p><ol><li>点击录制按钮（⚫）</li><li>进行页面操作</li><li>停止录制</li><li>分析火焰图：<ul><li>红色：JavaScript执行</li><li>紫色：页面渲染</li><li>绿色：页面绘制</li><li>灰色：空闲时间</li></ul></li></ol><h4 id="Memory面板"><a href="#Memory面板" class="headerlink" title="Memory面板"></a>Memory面板</h4><p>Memory面板三种分析方式：</p><ol><li><p>Heap Snapshot（堆快照）</p><ul><li>拍摄快照</li><li>对比前后变化</li><li>查看内存占用</li></ul></li><li><p>Allocation Timeline（分配时间轴）</p><ul><li>记录内存分配</li><li>查看对象生命周期</li><li>定位频繁GC</li></ul></li><li><p>Allocation Sampling（分配采样）</p><ul><li>JS堆分配</li><li>定位大对象</li></ul></li></ol><h4 id="常见性能问题"><a href="#常见性能问题" class="headerlink" title="常见性能问题"></a>常见性能问题</h4><p>排查要点：</p><ul><li>长任务阻塞</li><li>频繁GC</li><li>DOM操作过多</li><li>图片资源过大</li><li>未释放的事件监听</li><li>闭包导致的内存泄露</li></ul><h4 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h4><ul><li>使用防抖节流</li><li>虚拟列表</li><li>图片懒加载</li><li>合理使用缓存</li><li>及时解绑事件</li><li>避免闭包滥用</li><li>代码分割</li><li>资源压缩</li><li>CDN加速</li><li>合理缓存</li></ul><h3 id="移动端"><a href="#移动端" class="headerlink" title="移动端"></a>移动端</h3><p>常用方法：</p><ul><li>Chrome远程调试（Android）</li><li>Safari调试（iOS）</li><li>vConsole（移动端调试工具）</li><li>Eruda（移动端调试面板）</li><li>Charles&#x2F;Fiddler（抓包）</li></ul><p>Charles&#x2F;Fiddler 本地文件映射（https需要额外的配置）</p><h4 id="Charles配置"><a href="#Charles配置" class="headerlink" title="Charles配置"></a>Charles配置</h4><p>本地文件映射步骤：</p><ol><li>Tools -&gt; Map Local</li><li>Add New Mapping</li><li>设置：<ul><li>远程URL路径</li><li>本地文件路径</li><li>启用&#x2F;禁用规则</li></ul></li></ol><h3 id="Fiddler配置"><a href="#Fiddler配置" class="headerlink" title="Fiddler配置"></a>Fiddler配置</h3><p>AutoResponder设置：</p><ol><li>切换到AutoResponder标签</li><li>Enable rules</li><li>添加规则：<ul><li>匹配规则（正则&#x2F;通配符）</li><li>选择本地文件</li><li>设置响应类型</li></ul></li></ol><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul><li>替换线上JS&#x2F;CSS文件</li><li>修改API响应数据</li><li>测试不同版本</li><li>调试线上问题</li><li>模拟各种响应</li></ul>]]></content>
      
      
      <categories>
          
          <category> debug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动化测试</title>
      <link href="/one_hour/2018/02/07/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"/>
      <url>/one_hour/2018/02/07/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<ul><li>部署</li><li>jest+enzyme</li><li>注意点</li></ul><h3 id="前端自动化测试实践"><a href="#前端自动化测试实践" class="headerlink" title="前端自动化测试实践"></a>前端自动化测试实践</h3><h4 id="1-测试框架介绍"><a href="#1-测试框架介绍" class="headerlink" title="1. 测试框架介绍"></a>1. 测试框架介绍</h4><h5 id="Jest"><a href="#Jest" class="headerlink" title="Jest"></a>Jest</h5><ol><li><strong>基础配置</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jest.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">testEnvironment</span>: <span class="string">&#x27;jsdom&#x27;</span>,</span><br><span class="line"><span class="attr">setupFilesAfterEnv</span>: [<span class="string">&#x27;&lt;rootDir&gt;/src/setupTests.js&#x27;</span>],</span><br><span class="line"><span class="attr">moduleNameMapper</span>: &#123;</span><br><span class="line"><span class="string">&#x27;\\.(css|less|scss)$&#x27;</span>: <span class="string">&#x27;identity-obj-proxy&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;^@/(.)$&#x27;</span>: <span class="string">&#x27;&lt;rootDir&gt;/src/$1&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">collectCoverageFrom</span>: [<span class="string">&#x27;src//.&#123;js,jsx,ts,tsx&#125;&#x27;</span>]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>常用匹配器</strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">describe(&#x27;基础测试&#x27;, () =&gt; &#123;</span><br><span class="line">test(&#x27;相等性测试&#x27;, () =&gt; &#123;</span><br><span class="line">expect(2 + 2).toBe(4);</span><br><span class="line">expect(&#123; name: &#x27;test&#x27; &#125;).toEqual(&#123; name: &#x27;test&#x27; &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">test(&#x27;真值测试&#x27;, () =&gt; &#123;</span><br><span class="line">expect(true).toBeTruthy();</span><br><span class="line">expect(false).toBeFalsy();</span><br><span class="line">expect(null).toBeNull();</span><br><span class="line">&#125;);</span><br><span class="line">test(&#x27;包含测试&#x27;, () =&gt; &#123;</span><br><span class="line">expect([1, 2, 3]).toContain(2);</span><br><span class="line">expect(&#x27;hello&#x27;).toMatch(/llo/);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="Enzyme"><a href="#Enzyme" class="headerlink" title="Enzyme"></a>Enzyme</h5><ol><li><strong>组件测试设置</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setupTests.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">&#x27;enzyme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Adapter</span> <span class="keyword">from</span> <span class="string">&#x27;enzyme-adapter-react-16&#x27;</span>;</span><br><span class="line"><span class="title function_">configure</span>(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> <span class="title class_">Adapter</span>() &#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>组件渲染方式</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallow, mount &#125; <span class="keyword">from</span> <span class="string">&#x27;enzyme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./MyComponent&#x27;</span>;</span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;组件测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;浅渲染测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">shallow</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>);</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.title&#x27;</span>)).<span class="title function_">toHaveLength</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;完整渲染测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>);</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;button&#x27;</span>)).<span class="title function_">toHaveLength</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-测试类型"><a href="#2-测试类型" class="headerlink" title="2. 测试类型"></a>2. 测试类型</h4><h5 id="1-单元测试"><a href="#1-单元测试" class="headerlink" title="1. 单元测试"></a>1. 单元测试</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; formatDate &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;工具函数测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;日期格式化&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2024-01-01&#x27;</span>);</span><br><span class="line"><span class="title function_">expect</span>(<span class="title function_">formatDate</span>(date)).<span class="title function_">toBe</span>(<span class="string">&#x27;2024-01-01&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="2-组件测试"><a href="#2-组件测试" class="headerlink" title="2. 组件测试"></a>2. 组件测试</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Button.test.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;./Button&#x27;</span>;</span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Button组件&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;点击事件&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> onClick = jest.<span class="title function_">fn</span>();</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">shallow</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span> /&gt;</span></span>);</span><br><span class="line">wrapper.<span class="title function_">simulate</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line"><span class="title function_">expect</span>(onClick).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;禁用状态&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">shallow</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">disabled</span> /&gt;</span></span>);</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">prop</span>(<span class="string">&#x27;disabled&#x27;</span>)).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-异步测试"><a href="#3-异步测试" class="headerlink" title="3. 异步测试"></a>3. 异步测试</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchData &#125; <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span>;</span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;异步测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;异步API调用&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>();</span><br><span class="line"><span class="title function_">expect</span>(data).<span class="title function_">toEqual</span>(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;test&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="组件测试主要可以测试："><a href="#组件测试主要可以测试：" class="headerlink" title="组件测试主要可以测试："></a>组件测试主要可以测试：</h3><ul><li>交互行为（点击、输入等）</li><li>状态管理和更新</li><li>生命周期方法</li><li>异步操作（数据加载等）</li><li>条件渲染逻辑</li><li>样式和类名</li><li>组件间通信</li><li>错误边界处理</li><li>性能优化（如memo、useMemo等）</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Button组件测试示例</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Button组件测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 交互行为测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;点击事件测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> onClick = jest.<span class="title function_">fn</span>();</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span>);</span><br><span class="line">        </span><br><span class="line">        wrapper.<span class="title function_">simulate</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">        <span class="title function_">expect</span>(onClick).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="title function_">expect</span>(onClick).<span class="title function_">toHaveBeenCalledWith</span>(<span class="string">&#x27;someValue&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 状态变化测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;状态更新测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span>);</span><br><span class="line">        wrapper.<span class="title function_">find</span>(<span class="string">&#x27;button&#x27;</span>).<span class="title function_">simulate</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">state</span>(<span class="string">&#x27;count&#x27;</span>)).<span class="title function_">toBe</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.count-display&#x27;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 生命周期测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;组件生命周期&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> didMount = jest.<span class="title function_">spyOn</span>(<span class="title class_">Counter</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;componentDidMount&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span>);</span><br><span class="line">        <span class="title function_">expect</span>(didMount).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 异步操作测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;异步数据加载&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">UserList</span> /&gt;</span></span>);</span><br><span class="line">        <span class="comment">// 等待异步操作完成</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">act</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.user-item&#x27;</span>)).<span class="title function_">toHaveLength</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 条件渲染测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;条件渲染逻辑&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">visible</span>=<span class="string">&#123;false&#125;</span> /&gt;</span></span>);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.dialog&#x27;</span>)).<span class="title function_">toHaveLength</span>(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">visible</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.dialog&#x27;</span>)).<span class="title function_">toHaveLength</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 样式测试</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;样式类名测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> /&gt;</span></span>);</span><br><span class="line">        <span class="title function_">expect</span>(wrapper.<span class="title function_">hasClass</span>(<span class="string">&#x27;btn-primary&#x27;</span>)).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 测试不必要的重渲染</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;性能优化测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;验证React.memo的效果&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> renderSpy = jest.<span class="title function_">fn</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 一个使用memo的子组件</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">ChildComponent</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">renderSpy</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 父组件</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">ParentComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">const</span> data = <span class="string">&quot;test&quot;</span>;  <span class="comment">// 不变的props</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(c =&gt; c + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                        Count: &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">            );</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 挂载组件</span></span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">ParentComponent</span> /&gt;</span></span>);</span><br><span class="line">        <span class="title function_">expect</span>(renderSpy).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 点击按钮更新父组件</span></span><br><span class="line">        wrapper.<span class="title function_">find</span>(<span class="string">&#x27;button&#x27;</span>).<span class="title function_">simulate</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">        wrapper.<span class="title function_">find</span>(<span class="string">&#x27;button&#x27;</span>).<span class="title function_">simulate</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证子组件没有重新渲染</span></span><br><span class="line">        <span class="title function_">expect</span>(renderSpy).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 测试useMemo的缓存效果</span></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;验证useMemo的缓存效果&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> expensiveCalculation = jest.<span class="title function_">fn</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">Component</span> = (<span class="params">&#123; value &#125;</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> result = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">expensiveCalculation</span>(value);</span><br><span class="line">            &#125;, [value]);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;result&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">value</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span>);</span><br><span class="line">        <span class="title function_">expect</span>(expensiveCalculation).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用相同的value更新</span></span><br><span class="line">        wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">value</span>: <span class="number">1</span> &#125;);</span><br><span class="line">        <span class="comment">// 验证没有重新计算</span></span><br><span class="line">        <span class="title function_">expect</span>(expensiveCalculation).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用不同的value更新</span></span><br><span class="line">        wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">value</span>: <span class="number">2</span> &#125;);</span><br><span class="line">        <span class="comment">// 验证重新计算了</span></span><br><span class="line">        <span class="title function_">expect</span>(expensiveCalculation).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>每个框架的特点：<br>Jest: React生态，配置简单，速度快<br>Mocha: 灵活性高，可扩展性强<br>Cypress: 专注E2E测试，可视化界面<br>Vitest: Vite项目首选，兼容Jest API<br>Karma: 真实浏览器测试，支持多浏览器<br>选择建议：</p><ol><li>React项目 -&gt; Jest<br>Vue3+Vite项目 -&gt; Vitest<br>需要E2E测试 -&gt; Cypress<br>Node.js项目 -&gt; Mocha<br>浏览器兼容性测试 -&gt; Karma</li></ol>]]></content>
      
      
      <categories>
          
          <category> 自动化测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
            <tag> 测试 </tag>
            
            <tag> 自动化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路由实现</title>
      <link href="/one_hour/2018/02/07/%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/"/>
      <url>/one_hour/2018/02/07/%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<ul><li>history</li><li>hash</li><li>原理</li><li>实现</li><li>注意点</li></ul><h3 id="路由实现概述"><a href="#路由实现概述" class="headerlink" title="路由实现概述"></a>路由实现概述</h3><p>前端路由用于在单页应用(SPA)中根据 URL 改变显示不同的视图而不重载页面。常见实现方式有两类：基于 hash 的路由和基于 History API 的路由。两者原理不同，各有优缺点。</p><h3 id="两种路由方式对比"><a href="#两种路由方式对比" class="headerlink" title="两种路由方式对比"></a>两种路由方式对比</h3><ul><li>Hash 路由（#）<ul><li>原理：监听 location.hash 的变化（hashchange 事件），hash 后面的字符串表示路由状态。</li><li>优点：兼容性好，服务器无需特殊配置（因为 URL 的 hash 不发送到服务器）。</li><li>缺点：URL 中会带 #，对 SEO 不友好（搜索引擎对 hash 路由抓取有限）。</li></ul></li><li>History 路由（pushState &#x2F; popstate）<ul><li>原理：使用 history.pushState&#x2F;replaceState 修改浏览器地址栏并借助 popstate 处理前进&#x2F;后退，URL 看起来像正常路径。</li><li>优点：URL 友好、可用于 SEO（配合服务端渲染或服务器路由回退）。</li><li>缺点：服务器需要配置回退到 SPA 的入口页面（通常返回 index.html），以避免刷新 404。</li></ul></li></ul><h3 id="简单实现示例"><a href="#简单实现示例" class="headerlink" title="简单实现示例"></a>简单实现示例</h3><ul><li>简单 Hash 路由（最小实现）：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filepath:</span></span><br><span class="line"><span class="comment">// ...existing code...</span></span><br><span class="line"><span class="keyword">const</span> routes = &#123;</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>: <span class="function">() =&gt;</span> <span class="title function_">renderHome</span>(),</span><br><span class="line">  <span class="string">&#x27;/about&#x27;</span>: <span class="function">() =&gt;</span> <span class="title function_">renderAbout</span>(),</span><br><span class="line">  <span class="string">&#x27;/post/:id&#x27;</span>: <span class="function"><span class="params">params</span> =&gt;</span> <span class="title function_">renderPost</span>(params.<span class="property">id</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseHash</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> location.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">matchRoute</span>(<span class="params">path</span>) &#123;</span><br><span class="line">  <span class="comment">// 简单匹配：优先静态，再尝试带参数的模式（可用更完善的 path-to-regex）</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> pattern <span class="keyword">in</span> routes) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pattern.<span class="title function_">includes</span>(<span class="string">&#x27;:&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;^&#x27;</span> + pattern.<span class="title function_">replace</span>(<span class="regexp">/:\w+/g</span>, <span class="string">&#x27;([^/]+)&#x27;</span>) + <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> m = path.<span class="title function_">match</span>(regex);</span><br><span class="line">      <span class="keyword">if</span> (m) &#123;</span><br><span class="line">        <span class="keyword">const</span> keys = (pattern.<span class="title function_">match</span>(<span class="regexp">/:\w+/g</span>) || []).<span class="title function_">map</span>(<span class="function"><span class="params">k</span> =&gt;</span> k.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">const</span> params = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(keys.<span class="title function_">map</span>(<span class="function">(<span class="params">k, i</span>) =&gt;</span> [k, <span class="built_in">decodeURIComponent</span>(m[i+<span class="number">1</span>])]));</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">handler</span>: routes[pattern], params &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pattern === path) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">handler</span>: routes[pattern], <span class="attr">params</span>: &#123;&#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onHashChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> path = <span class="title function_">parseHash</span>();</span><br><span class="line">  <span class="keyword">const</span> matched = <span class="title function_">matchRoute</span>(path);</span><br><span class="line">  <span class="keyword">if</span> (matched) matched.<span class="title function_">handler</span>(matched.<span class="property">params</span>);</span><br><span class="line">  <span class="keyword">else</span> <span class="title function_">renderNotFound</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;hashchange&#x27;</span>, onHashChange);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, onHashChange);</span><br></pre></td></tr></table></figure></li><li>基于 History API 的简单路由：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filepath:</span></span><br><span class="line"><span class="comment">// ...existing code...</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">navigateTo</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>, <span class="string">&#x27;&#x27;</span>, url);</span><br><span class="line">  <span class="title function_">onLocationChange</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">replaceTo</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  history.<span class="title function_">replaceState</span>(<span class="literal">null</span>, <span class="string">&#x27;&#x27;</span>, url);</span><br><span class="line">  <span class="title function_">onLocationChange</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onLocationChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> path = location.<span class="property">pathname</span> || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> matched = <span class="title function_">matchRoute</span>(path); <span class="comment">// reuse matchRoute（需支持不含#的路径）</span></span><br><span class="line">  <span class="keyword">if</span> (matched) matched.<span class="title function_">handler</span>(matched.<span class="property">params</span>);</span><br><span class="line">  <span class="keyword">else</span> <span class="title function_">renderNotFound</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, onLocationChange);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> a = e.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!a) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">const</span> isExternal = a.<span class="property">host</span> !== location.<span class="property">host</span> || a.<span class="title function_">hasAttribute</span>(<span class="string">&#x27;target&#x27;</span>) || a.<span class="title function_">hasAttribute</span>(<span class="string">&#x27;download&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!isExternal) &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">navigateTo</span>(a.<span class="property">pathname</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, onLocationChange);</span><br></pre></td></tr></table></figure></li></ul><h3 id="路由匹配与参数解析"><a href="#路由匹配与参数解析" class="headerlink" title="路由匹配与参数解析"></a>路由匹配与参数解析</h3><ul><li>推荐使用稳定的路径匹配库（如 path-to-regexp、route-parser），避免手写正则带来的边界问题。</li><li>注意对参数做 decodeURIComponent&#x2F;encodeURIComponent，处理空段、尾斜杠一致性。</li></ul><h3 id="服务端配置（History-路由必需）"><a href="#服务端配置（History-路由必需）" class="headerlink" title="服务端配置（History 路由必需）"></a>服务端配置（History 路由必需）</h3><ul><li>所有非静态资源的请求应返回 SPA 的入口页（index.html），由前端路由决定视图。</li><li>对于静态资源（JS&#x2F;CSS&#x2F;图片）应保留正常静态处理。<br>若支持 SSR，请在服务器端做对应路由渲染并返回预渲染 HTML 提升 SEO。</li></ul><h3 id="边界与注意点"><a href="#边界与注意点" class="headerlink" title="边界与注意点"></a>边界与注意点</h3><ul><li>SEO 与爬虫：Hash 路由对 SEO 不友好；使用 History + SSR 或预渲染可改善。</li><li>刷新问题：History 路由刷新需服务器回退；Hash 路由无需服务器调整。</li><li>滚动恢复：处理导航时保存&#x2F;恢复滚动位置（浏览器默认可能不同）。</li><li>访问控制：导航守卫（同步&#x2F;异步）用于鉴权、重定向。</li><li>性能与内存：避免在路由切换时泄露事件监听器或定时器。</li><li>URL 编码：注意路径与查询的编码&#x2F;解码、重复斜杠、尾随斜杠的规范化。</li><li>后退&#x2F;替换：用 replaceState 做无需历史记录的替换（如登录后替换回上一个状态）。</li></ul><h3 id="实践建议"><a href="#实践建议" class="headerlink" title="实践建议"></a>实践建议</h3><ul><li>小项目或兼容性要求高：hash 路由快速简单。</li><li>生产级 SPA：优先 history 路由 + 服务端配置或 SSR。</li><li>使用成熟路由库（Vue Router &#x2F; React Router &#x2F; router5 等）来减少坑与提升功能（懒加载、嵌套路由、导航守卫、滚动行为等）。</li><li>提前考虑基路径(base)、404&#x2F;重定向策略与国际化路由设计。</li></ul><p>小结：理解 hash 与 history 的原理与权衡，再根据项目需求选择实现方式与工具，能避免常见的刷新、SEO、服务器配置等问题。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>脚手架实现</title>
      <link href="/one_hour/2018/02/07/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AE%9E%E7%8E%B0/"/>
      <url>/one_hour/2018/02/07/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>脚手架（scaffold &#x2F; scaffolding）是用来快速生成项目骨架、约定文件和初始配置的工具。常见目标：生成目录结构、模板文件、默认配置、安装依赖、初始化版本控制等，帮助团队保持一致性并提升开发效率。</p><h3 id="实现原理（核心要素）"><a href="#实现原理（核心要素）" class="headerlink" title="实现原理（核心要素）"></a>实现原理（核心要素）</h3><ul><li>模板引擎：用 ejs &#x2F; handlebars &#x2F; mustache 等渲染模板文件，替换占位符。</li><li>交互与配置：用 inquirer &#x2F; prompts 获取用户输入（项目名、license、包管理器等）。</li><li>文件操作：复制&#x2F;渲染模板到目标目录（fs-extra、globby）。</li><li>依赖安装：可选择自动执行 npm&#x2F;yarn&#x2F;pnpm install（child_process.exec）。</li><li>初始化 VCS：可选 git init、commit。</li><li>扩展与插件：提供 hooks 或插件接口，支持后续扩展（如生成 CI、Dockerfile）。</li><li>幂等与安全：检测目标路径是否为空或冲突，提供覆盖&#x2F;跳过策略。</li></ul><h3 id="常见脚手架工具简介"><a href="#常见脚手架工具简介" class="headerlink" title="常见脚手架工具简介"></a>常见脚手架工具简介</h3><ul><li>Hexo<ul><li>主要是静态博客框架，包含 scaffold 概念（source&#x2F;_posts&#x2F;scaffolds），<code>hexo new</code> 使用 scaffold 生成带 front-matter 的文章&#x2F;页面模板。</li><li>使用场景：博客内容模板化（post、page、draft），主题&#x2F;插件生态。</li></ul></li><li>Metalsmith<ul><li>轻量文件管道静态站点生成器，通过插件链处理文件（读取 -&gt; transform -&gt; write）。</li><li>可用于构建自定义脚手架或作为生成步骤的一部分。</li></ul></li><li>Yeoman<ul><li>流行的项目脚手架生态，基于 generator（npm 包）定义交互、文件模板和写入步骤。</li><li>特点：强交互、蓝图式生成、社区 generator 丰富（React&#x2F;Angular&#x2F;Vue 等）。</li><li>常用命令：yo <generator>，发布为 npm 包，使用 yeoman-generator API 处理 prompts、写入、安装依赖。</li></ul></li></ul><h3 id="简单实现示例（最小-CLI-脚手架）"><a href="#简单实现示例（最小-CLI-脚手架）" class="headerlink" title="简单实现示例（最小 CLI 脚手架）"></a>简单实现示例（最小 CLI 脚手架）</h3><p>示例功能：询问项目名，复制模板并渲染 package.json，选择是否安装依赖。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; execSync &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, install &#125; = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;Project name&#x27;</span>, <span class="attr">default</span>: <span class="string">&#x27;my-app&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;install&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;confirm&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;Install dependencies?&#x27;</span>, <span class="attr">default</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  ]);</span><br><span class="line">  <span class="keyword">const</span> target = path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), name);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">await</span> fs.<span class="title function_">pathExists</span>(target)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Target exists. Aborting.&#x27;</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">copy</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;templates&#x27;</span>), target);</span><br><span class="line">  <span class="keyword">const</span> pkgTpl = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(target, <span class="string">&#x27;package.json.ejs&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(path.<span class="title function_">join</span>(target, <span class="string">&#x27;package.json&#x27;</span>), ejs.<span class="title function_">render</span>(pkgTpl, &#123; name &#125;));</span><br><span class="line">  <span class="keyword">if</span> (install) &#123;</span><br><span class="line">    <span class="title function_">execSync</span>(<span class="string">&#x27;npm install&#x27;</span>, &#123; <span class="attr">cwd</span>: target, <span class="attr">stdio</span>: <span class="string">&#x27;inherit&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Scaffold created at&#x27;</span>, target);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">run</span>();</span><br></pre></td></tr></table></figure><p>说明：模板文件可放 templates&#x2F; 下，使用 package.json.ejs 等占位渲染。</p><h3 id="Yeoman-generator-最小骨架"><a href="#Yeoman-generator-最小骨架" class="headerlink" title="Yeoman generator 最小骨架"></a>Yeoman generator 最小骨架</h3><ul><li>目录结构：generator-my&#x2F;generators&#x2F;app&#x2F;index.js、templates&#x2F;**</li><li>index.js 使用 this.prompt、this.fs.copyTpl、this.npmInstall 等 API。</li></ul><p>示例（核心片段）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Generator</span> = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">prompting</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">answers</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">prompt</span>([&#123; <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;Project name&#x27;</span> &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">writing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">templatePath</span>(<span class="string">&#x27;**/*&#x27;</span>),</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="variable language_">this</span>.<span class="property">answers</span>.<span class="property">name</span>),</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">answers</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">npmInstall</span>([], &#123;&#125;, &#123; <span class="attr">cwd</span>: <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="variable language_">this</span>.<span class="property">answers</span>.<span class="property">name</span>) &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Hexo-scaffold-快速说明"><a href="#Hexo-scaffold-快速说明" class="headerlink" title="Hexo scaffold 快速说明"></a>Hexo scaffold 快速说明</h3><ul><li>把模板放在主题或站点的 scaffolds 目录（如 scaffolds&#x2F;post），内容为 front-matter 模板。</li><li>使用：hexo new “title” 会基于 scaffolds&#x2F;post 生成文章文件。</li></ul><h3 id="注意点与最佳实践"><a href="#注意点与最佳实践" class="headerlink" title="注意点与最佳实践"></a>注意点与最佳实践</h3><ul><li>可配置性：提供选项（语言、框架、样式、测试），避免硬编码。</li><li>可复现性：生成后记录依赖版本、提供 lock 文件。</li><li>幂等与安全：遇文件冲突提供交互或 –force 选项，避免无意覆盖。</li><li>模块化模板：拆分可复用片段（LICENSE、CI、Dockerfile）。</li><li>测试：为 generator 添加集成测试（如 Yeoman Test，或用临时目录断言文件生成）。</li><li>发布与文档：把 CLI 做为 bin 导出，文档写清使用示例与选项，发布到 npm。</li><li>性能：避免在模板中执行大量同步阻塞操作，异步 IO 更友好。</li><li>安全：慎用模板中的任意代码执行，避免注入风险。</li></ul><p>小结：脚手架的核心是「交互+模板+文件写入+可选安装&#x2F;初始化」，工具层面可选 Yeoman、自己用 Node 实现、或结合静态站生成器（Hexo&#x2F;Metalsmith）完成更复杂的流水线。根据项目复杂度选择更成熟的生态（Yeoman）或轻量可控的自实现方案。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚手架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跨域问题</title>
      <link href="/one_hour/2018/02/07/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"/>
      <url>/one_hour/2018/02/07/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<ul><li>原理</li><li>解决方法</li></ul><h3 id="概览（同源策略）"><a href="#概览（同源策略）" class="headerlink" title="概览（同源策略）"></a>概览（同源策略）</h3><ul><li>同源策略（Same-Origin Policy）：只有协议、主机、端口三者都相同才算同源（scheme:&#x2F;&#x2F;host:port）。</li><li>浏览器限制跨源的 DOM 读取与部分请求，防止恶意脚本窃取数据，但允许某些资源加载（图片、script、link 等）.</li></ul><h3 id="常见解决方法（简明）"><a href="#常见解决方法（简明）" class="headerlink" title="常见解决方法（简明）"></a>常见解决方法（简明）</h3><ol><li>CORS（推荐）<br>通过服务器在响应头添加 Access-Control-Allow-* 系列允许跨域请求。<br>简单请求：GET&#x2F;POST（Content-Type 为简单类型）直接发送；复杂请求会触发预检（OPTIONS）。<br>常用头：<br>  Access-Control-Allow-Origin: <a href="https://example.com/">https://example.com</a> 或 *<br>  Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS<br>  Access-Control-Allow-Headers: X-Requested-With,Content-Type,Authorization<br>  Access-Control-Allow-Credentials: true （若发送 cookie，不能与 * 一起使用）<br>Express 示例： <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;https://your.site&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;GET,POST,PUT,DELETE,OPTIONS&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type,Authorization&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="string">&#x27;true&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;OPTIONS&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">sendStatus</span>(<span class="number">204</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>JSONP（仅限 GET，老方法）<br>通过 <code>&lt;script&gt;</code>标签请求服务端返回一段调用回调的 JS。<br>安全&#x2F;功能受限，不支持 POST、Headers 等。</li><li>代理（同源代理）<br>前端请求同源的后端接口，后端转发到目标 API（常用于开发或绕过不支持 CORS 的第三方）。<br>Nginx 简单 proxy_pass 示例：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /api/ &#123;</span><br><span class="line">  proxy_pass https://api.example.com/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>window.postMessage（跨窗口&#x2F;iframe 通信）<br>页面与 iframe、子窗口之间安全传递消息，需校验 origin。<br>使用场景：跨域 iframe 通信、OAuth 回调等。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送</span></span><br><span class="line">otherWindow.<span class="title function_">postMessage</span>(&#123; <span class="attr">type</span>:<span class="string">&#x27;ok&#x27;</span> &#125;, <span class="string">&#x27;https://target.com&#x27;</span>);</span><br><span class="line"><span class="comment">// 接收</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">origin</span> !== <span class="string">&#x27;https://target.com&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// 处理 e.data</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>document.domain（仅限二级域名相同的场景，逐步废弃&#x2F;风险）</li><li>WebSocket &#x2F; Server-Sent Events：与 HTTP 不同的连接模型，有自己的跨源策略（通常由服务器决定）.</li></ol><h3 id="预检（Preflight）"><a href="#预检（Preflight）" class="headerlink" title="预检（Preflight）"></a>预检（Preflight）</h3><ul><li>复杂请求会先发 OPTIONS 请求，服务器需返回允许的方法、头以及允许来源。</li><li>常见问题：浏览器控制台显示 401&#x2F;403&#x2F;404 或缺少 Access-Control-Allow-*。</li></ul><h3 id="带凭证请求（Cookies-Authorization）"><a href="#带凭证请求（Cookies-Authorization）" class="headerlink" title="带凭证请求（Cookies &#x2F; Authorization）"></a>带凭证请求（Cookies &#x2F; Authorization）</h3><ul><li>前端需设置 fetch&#x2F;axios withCredentials: true 或 fetch 的 credentials: ‘include’。</li><li>服务器需返回 Access-Control-Allow-Credentials: true，且 Access-Control-Allow-Origin 不能为 ‘*’。</li></ul><h3 id="安全与实践建议"><a href="#安全与实践建议" class="headerlink" title="安全与实践建议"></a>安全与实践建议</h3><ul><li>仅允许受信任的域名，避免使用 Access-Control-Allow-Origin: * 配合凭证。</li><li>尽量在服务器端做鉴权与速率限制，代理比客户端绕过更安全可控。</li><li>检查浏览器控制台和网络面板的预检与响应头定位问题。</li></ul><p>小结：优先用 CORS + 合理服务端配置；不支持时用代理或 window.postMessage 等替代方案，根据场景权衡安全与兼容。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 跨域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js原型链</title>
      <link href="/one_hour/2018/02/07/js%E5%8E%9F%E5%9E%8B%E9%93%BE/"/>
      <url>/one_hour/2018/02/07/js%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<ul><li>prototype</li><li>constructor</li><li>new</li></ul><h2 id="原型链的构成"><a href="#原型链的构成" class="headerlink" title="原型链的构成"></a>原型链的构成</h2><p>对象.<strong>proto</strong> -&gt; 原型对象<br>原型对象.constructor -&gt; 构造函数<br>构造函数.prototype -&gt; 原型对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Person</span>);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; eating&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);  <span class="comment">// 继承属性</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承方法</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Dog</span>;</span><br></pre></td></tr></table></figure><h2 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查原型链</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj)    <span class="comment">// 获取原型</span></span><br><span class="line">obj.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;prop&#x27;</span>)    <span class="comment">// 是否自身属性</span></span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>     <span class="comment">// 是否在原型链上</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">create</span>(proto)          <span class="comment">// 创建指定原型的对象</span></span><br></pre></td></tr></table></figure><h2 id="属性查找过程"><a href="#属性查找过程" class="headerlink" title="属性查找过程"></a>属性查找过程</h2><p>obj.prop<br>-&gt; obj自身属性<br>-&gt; obj.__proto__属性<br>-&gt; obj.<strong>proto</strong>.__proto__属性<br>-&gt; … 直到null</p><h3 id="constructor属性"><a href="#constructor属性" class="headerlink" title="constructor属性"></a>constructor属性</h3><ul><li>标识对象由哪个构造函数创建</li><li>维护正确的原型链关系</li><li>方便实例识别其构造函数</li></ul><h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><ul><li>创建空对象</li><li>将空对象的__proto__指向构造函数的prototype</li><li>将构造函数的this指向空对象</li><li>执行构造函数</li><li>返回空对象</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new Person(&#x27;张三&#x27;) 实际上做了：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newOperator</span>(<span class="params">Constructor, ...args</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 创建一个空对象，原型指向构造函数的prototype</span></span><br><span class="line">    <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 将构造函数的this指向这个对象</span></span><br><span class="line">    <span class="comment">// 3. 执行构造函数</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="title class_">Constructor</span>.<span class="title function_">apply</span>(obj, args);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 如果构造函数返回对象，则返回该对象</span></span><br><span class="line">    <span class="comment">// 否则返回第一步创建的对象</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>) ? result : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>函数都可以作为构造函数，但是箭头函数不行</li><li>箭头函数没有自己的this</li><li>箭头函数的this是在定义时就确定的，指向外层作用域的this</li><li>箭头函数没有prototype属性</li><li>不能通过call&#x2F;apply&#x2F;bind改变箭头函数的this</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call：立即执行，参数列表</span></span><br><span class="line"><span class="keyword">function</span>.<span class="title function_">call</span>(thisArg, arg1, arg2, ...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// apply：立即执行，参数数组</span></span><br><span class="line"><span class="keyword">function</span>.<span class="title function_">apply</span>(thisArg, [arg1, arg2, ...])</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind：返回新函数，参数列表</span></span><br><span class="line"><span class="keyword">function</span>.<span class="title function_">bind</span>(thisArg, arg1, arg2, ...)</span><br></pre></td></tr></table></figure><h2 id="类和原型"><a href="#类和原型" class="headerlink" title="类和原型"></a>类和原型</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> 原型链 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js异步编程</title>
      <link href="/one_hour/2018/02/07/js%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
      <url>/one_hour/2018/02/07/js%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="计划内容"><a href="#计划内容" class="headerlink" title="计划内容"></a>计划内容</h3><ul><li>单线程</li><li>事件驱动</li><li>callback</li><li>setTimeout、setInterval</li><li>Promise</li><li>generator</li><li>async&#x2F;await</li></ul><h3 id="JavaScript的单线程特性"><a href="#JavaScript的单线程特性" class="headerlink" title="JavaScript的单线程特性"></a>JavaScript的单线程特性</h3><p>JavaScript是一门单线程的编程语言，这意味着它只有一个主线程来处理所有的任务。这种设计是由其最初在浏览器环境下的应用场景决定的。</p><h3 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a>事件驱动</h3><p>JavaScript通过事件驱动的方式来处理异步操作：</p><ul><li>事件循环（Event Loop）</li><li>事件队列（Event Queue）</li><li>宏任务（Macro-task）和微任务（Micro-task）</li></ul><h4 id="1-事件循环（Event-Loop）"><a href="#1-事件循环（Event-Loop）" class="headerlink" title="1. 事件循环（Event Loop）"></a>1. 事件循环（Event Loop）</h4><p>事件循环是JavaScript实现异步的核心机制，它主要负责：</p><ul><li>执行同步代码</li><li>检查宏任务队列</li><li>执行微任务队列</li><li>更新渲染</li></ul><p>执行顺序：</p><ol><li>执行同步代码（主线程）</li><li>清空微任务队列（micro-task queue）</li><li>执行一个宏任务（macro-task queue）</li><li>重复步骤2-3<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件循环示例</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>); <span class="comment">// 同步代码</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>); <span class="comment">// 宏任务</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>); <span class="comment">// 微任务</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>); <span class="comment">// 同步代码</span></span><br><span class="line"><span class="comment">// 输出顺序：1 -&gt; 4 -&gt; 3 -&gt; 2</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="2-事件队列（Event-Queue）"><a href="#2-事件队列（Event-Queue）" class="headerlink" title="2. 事件队列（Event Queue）"></a>2. 事件队列（Event Queue）</h4><p>JavaScript中有两种主要的任务队列：</p><ol><li><p><strong>宏任务队列（Macro-task Queue）</strong></p><ul><li>setTimeout&#x2F;setInterval</li><li>setImmediate (Node.js)</li><li>requestAnimationFrame (浏览器)</li><li>I&#x2F;O操作</li><li>UI渲染</li><li>script标签</li></ul></li><li><p><strong>微任务队列（Micro-task Queue）</strong></p><ul><li>Promise.then&#x2F;catch&#x2F;finally</li><li>process.nextTick (Node.js)</li><li>MutationObserver</li><li>queueMicrotask</li></ul></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宏任务和微任务的执行顺序</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;宏任务1&#x27;</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微任务2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微任务1&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;宏任务2&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 输出顺序：微任务1 -&gt; 宏任务1 -&gt; 微任务2 -&gt; 宏任务2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-实际应用示例"><a href="#3-实际应用示例" class="headerlink" title="3. 实际应用示例"></a>3. 实际应用示例</h4><ol><li><strong>异步操作的优先级控制</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高优先级任务使用微任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">highPriorityTask</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;高优先级任务执行&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 低优先级任务使用宏任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">lowPriorityTask</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;低优先级任务执行&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>避免回调地狱的最佳实践</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不好的实践</span></span><br><span class="line"><span class="comment">// 回调地狱示例</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Promise改写</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用async/await改写（最优雅）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sequence</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line"><span class="title function_">sequence</span>();</span><br><span class="line"><span class="comment">// 好的实践</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">betterWay</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="4-注意事项"><a href="#4-注意事项" class="headerlink" title="4. 注意事项"></a>4. 注意事项</h4><ol><li><strong>性能考虑</strong></li></ol><ul><li>微任务优先级高，但不要过度使用</li><li>避免在微任务中执行耗时操作</li><li>合理使用宏任务分散负载</li></ul><ol start="2"><li><p><strong>常见陷阱</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 死循环微任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deadlock</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title function_">deadlock</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这会阻塞事件循环，导致宏任务无法执行</span></span><br></pre></td></tr></table></figure></li><li><p><strong>最佳实践</strong></p></li></ol><ul><li>耗时操作放入宏任务队列</li><li>需要即时响应的放入微任务队列</li><li>合理组合async&#x2F;await与Promise</li><li>避免同步阻塞操作</li></ul><h3 id="回调函数（Callback）"><a href="#回调函数（Callback）" class="headerlink" title="回调函数（Callback）"></a>回调函数（Callback）</h3><p>最基础的异步编程方式，但可能导致回调地狱：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调地狱示例</span></span><br><span class="line"><span class="title function_">getData</span>(<span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="title function_">getMoreData</span>(a, <span class="keyword">function</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    <span class="title function_">getMoreData</span>(b, <span class="keyword">function</span>(<span class="params">c</span>) &#123;</span><br><span class="line">      <span class="title function_">getMoreData</span>(c, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据获取完成&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="setTimeout和setInterval"><a href="#setTimeout和setInterval" class="headerlink" title="setTimeout和setInterval"></a>setTimeout和setInterval</h3><p>用于延时执行和周期性执行任务的定时器函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setTimeout示例</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;延时执行&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>Promise是一种更优雅的异步编程解决方案，可以有效避免回调地狱：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise示例</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;数据获取完成&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><p>生成器函数提供了一种可以暂停和恢复执行的方式：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dataGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> data1 = <span class="keyword">yield</span> <span class="title function_">getData</span>();</span><br><span class="line"><span class="keyword">const</span> data2 = <span class="keyword">yield</span> <span class="title function_">getMoreData</span>(data1);</span><br><span class="line"><span class="keyword">const</span> data3 = <span class="keyword">yield</span> <span class="title function_">getMoreData</span>(data2);</span><br><span class="line"><span class="keyword">return</span> data3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用生成器</span></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">dataGenerator</span>();</span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data1</span> =&gt;</span> &#123;</span><br><span class="line">  gen.<span class="title function_">next</span>(data1).<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data2</span> =&gt;</span> &#123;</span><br><span class="line">    gen.<span class="title function_">next</span>(data2).<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data3</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;最终数据:&#x27;</span>, data3);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="async-await"><a href="#async-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h3><p>async&#x2F;await是ES2017引入的一种更简洁的异步编程方式,它是Generator的语法糖:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async/await示例</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data1 = <span class="keyword">await</span> <span class="title function_">getData</span>();</span><br><span class="line">  <span class="keyword">const</span> data2 = <span class="keyword">await</span> <span class="title function_">getMoreData</span>(data1);</span><br><span class="line">  <span class="keyword">const</span> data3 = <span class="keyword">await</span> <span class="title function_">getMoreData</span>(data2);</span><br><span class="line">  <span class="keyword">return</span> data3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实践建议"><a href="#实践建议" class="headerlink" title="实践建议"></a>实践建议</h3><ol><li>优先使用async&#x2F;await进行异步编程</li><li>合理使用Promise.all()处理并发请求</li><li>注意错误处理和异常捕获</li><li>避免回调地狱</li><li>合理使用定时器，注意及时清除不需要的定时器</li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JavaScript的异步编程经历了从回调函数、Promise、Generator到async&#x2F;await的演进过程，每种方式都有其适用场景：</p><ul><li>回调函数：简单场景</li><li>Promise：中等复杂度的异步操作</li><li>Generator：需要精细控制执行流程的场景</li><li>async&#x2F;await：复杂的异步流程控制</li></ul><h3 id="异步编程方案对比"><a href="#异步编程方案对比" class="headerlink" title="异步编程方案对比"></a>异步编程方案对比</h3><h4 id="1-回调函数（Callback）"><a href="#1-回调函数（Callback）" class="headerlink" title="1. 回调函数（Callback）"></a>1. 回调函数（Callback）</h4><p>优点：</p><ul><li>简单直接，容易理解</li><li>适用于简单的异步操作</li><li>基础代码量少</li></ul><p>缺点：</p><ul><li>容易产生回调地狱</li><li>错误处理复杂</li><li>代码可读性差</li><li>不能使用try-catch捕获错误</li></ul><p>适用场景：</p><ul><li>简单的一次性异步操作</li><li>事件监听处理</li></ul><h4 id="2-Promise"><a href="#2-Promise" class="headerlink" title="2. Promise"></a>2. Promise</h4><p>优点：</p><ul><li>链式调用，避免回调地狱</li><li>统一的错误处理机制</li><li>多个异步操作的状态管理</li><li>支持并行操作（Promise.all&#x2F;race）</li></ul><p>缺点：</p><ul><li>无法取消执行</li><li>无法获取执行进度</li><li>代码较callback略微复杂</li></ul><p>适用场景：</p><ul><li>多个依赖异步操作</li><li>需要错误统一处理</li><li>并行异步操作</li></ul><h4 id="3-Generator"><a href="#3-Generator" class="headerlink" title="3. Generator"></a>3. Generator</h4><p>默认执行之后会返回一个迭代器，<br>优点：</p><ul><li>可以暂停和恢复执行</li><li>提供了更好的异步流程控制</li><li>可以在生成器函数内部捕获错误</li></ul><p>缺点：</p><ul><li>需要手动执行next()</li><li>代码较复杂</li><li>不直观，理解成本高</li></ul><p>适用场景：</p><ul><li>需要精确控制异步流程</li><li>需要实现迭代器</li><li>复杂的状态管理<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建自定义的迭代规则</span></span><br><span class="line"><span class="comment">// 创建一个范围迭代器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">range</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用迭代器</span></span><br><span class="line"><span class="keyword">const</span> iterator = <span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> value <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2状态机管理：</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">playerStateMachine</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">&#x27;IDLE&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(state) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;IDLE&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;等待操作&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;RUNNING&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;正在奔跑&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;JUMPING&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;正在跳跃&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> player = <span class="title function_">playerStateMachine</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// &quot;等待操作&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>(<span class="string">&#x27;RUNNING&#x27;</span>).<span class="property">value</span>); <span class="comment">// &quot;正在奔跑&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>(<span class="string">&#x27;JUMPING&#x27;</span>).<span class="property">value</span>); <span class="comment">// &quot;正在跳跃&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 异步操作控制</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">dataFetchFlow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 显示加载状态</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">showLoading</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">yield</span> <span class="title function_">fetchData</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理数据</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">processData</span>(data);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 隐藏加载状态</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">hideLoading</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">handleError</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 工作流程控制</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">uploadProcess</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 检查文件</span></span><br><span class="line">    <span class="keyword">const</span> file = <span class="keyword">yield</span> <span class="string">&#x27;检查文件&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;文件不存在&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 压缩文件</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;压缩文件&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 上传</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="string">&#x27;上传中&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新界面</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;更新完成&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 表单验证流程</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">formValidation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 验证用户名</span></span><br><span class="line">    <span class="keyword">const</span> username = <span class="keyword">yield</span> <span class="string">&#x27;请输入用户名&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!username) <span class="keyword">yield</span> <span class="string">&#x27;用户名不能为空&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证密码</span></span><br><span class="line">    <span class="keyword">const</span> password = <span class="keyword">yield</span> <span class="string">&#x27;请输入密码&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (password.<span class="property">length</span> &lt; <span class="number">6</span>) <span class="keyword">yield</span> <span class="string">&#x27;密码太短&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证邮箱</span></span><br><span class="line">    <span class="keyword">const</span> email = <span class="keyword">yield</span> <span class="string">&#x27;请输入邮箱&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!email.<span class="title function_">includes</span>(<span class="string">&#x27;@&#x27;</span>)) <span class="keyword">yield</span> <span class="string">&#x27;邮箱格式错误&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;验证通过&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h4><ol><li>for of这里为啥没有使用next()?<br>可以手动使用next，也可以直接使用for of，Generator函数自动实现了迭代器协议，返回的对象自动实现Symbol.iterator方法;for of 循环内部自动调用next了;展开运算符；解构赋值；Array.from都会自动调用迭代器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for...of 循环内部大致相当于：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">forOf</span>(<span class="params">iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = iterator.<span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">while</span>(!result.<span class="property">done</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">value</span>);</span><br><span class="line">        result = iterator.<span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这些语法都会自动调用迭代器：</span></span><br><span class="line"><span class="keyword">const</span> numbers = [...<span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>)];  <span class="comment">// 展开运算符</span></span><br><span class="line"><span class="keyword">const</span> [a, b, c] = <span class="title function_">range</span>(<span class="number">1</span>, <span class="number">3</span>);     <span class="comment">// 解构赋值</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>));           <span class="comment">// Array.from</span></span><br></pre></td></tr></table></figure></li><li>Generator函数是为啥没有显式的return，但是却可以调用它的返回值？<br>Generator函数的隐式返回是Javascript引擎在调用时自动完成的，创建迭代器对象，设置内部状态，实现迭代器协议，返回这个迭代器对象。所以它总是会返回一个迭代器对象。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Generator函数的简化实现原理</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">simpleGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;开始执行&#x27;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;    <span class="comment">// 第一个暂停点</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;    <span class="comment">// 第二个暂停点</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;结束执行&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们调用Generator函数时，JavaScript引擎实际上会：</span></span><br><span class="line"><span class="comment">// 1. 创建一个迭代器对象</span></span><br><span class="line"><span class="comment">// 2. 设置初始状态</span></span><br><span class="line"><span class="comment">// 大致相当于以下代码：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建迭代器对象</span></span><br><span class="line">    <span class="keyword">const</span> iterator = &#123;</span><br><span class="line">        <span class="comment">// 内部状态</span></span><br><span class="line">        <span class="attr">_state</span>: <span class="number">0</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// next方法实现</span></span><br><span class="line">        <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span>(<span class="variable language_">this</span>.<span class="property">_state</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">_state</span> = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">_state</span> = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 实现迭代器协议</span></span><br><span class="line">        [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> iterator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>有什么更真实的场景会使用到状态机呢？（TODO: 还需要更深入的学习了解）<br>游戏角色的状态（初始化，攻击，受伤，死亡等），中间可以加入其他不是这几个的动作或者事件。（状态可以自动保存在闭包中，不需要额外的状态管理代码）其他的需要手动维护状态，保存和恢复需要显示编写。</li></ol><h4 id="使用Generator的关键考虑因素"><a href="#使用Generator的关键考虑因素" class="headerlink" title="使用Generator的关键考虑因素"></a>使用Generator的关键考虑因素</h4><ol><li>何时使用：</li></ol><ul><li>需要延迟计算</li><li>需要控制执行流程</li><li>需要自定义迭代逻辑</li><li>处理大量数据时需要分步处理</li></ul><ol start="2"><li>何时不使用：</li></ol><ul><li>简单的异步操作（用async&#x2F;await更合适）</li><li>不需要暂停&#x2F;恢复的操作</li><li>团队对Generator不熟悉的情况</li></ul><ol start="3"><li>注意事项：</li></ol><ul><li>Generator函数的错误处理需要特别注意</li><li>需要考虑内存使用（特别是无限序列）</li><li>调试可能比普通函数更复杂</li></ul><h4 id="4-Async-Await"><a href="#4-Async-Await" class="headerlink" title="4. Async&#x2F;Await"></a>4. Async&#x2F;Await</h4><p>优点：</p><ul><li>同步代码风格编写异步</li><li>简洁直观，易于理解</li><li>更好的错误处理机制</li><li>支持try-catch捕获异常</li><li>便于调试</li></ul><p>缺点：</p><ul><li>可能导致性能问题（如果使用不当）</li><li>无法处理取消操作</li><li>await会阻塞后续代码执行</li></ul><p>适用场景：</p><ul><li>复杂的异步业务逻辑</li><li>需要顺序执行的异步操作</li><li>依赖前一个异步结果的操作</li></ul><h4 id="如何取消异步操作"><a href="#如何取消异步操作" class="headerlink" title="如何取消异步操作"></a>如何取消异步操作</h4><p>如果是fetch请求，优先使用AbortController<br>如果需要精细控制，考虑Generator<br>如果是复杂的异步流程，考虑RxJS<br>如果是简单场景，可以使用自定义Promise</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> 异步编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js里的this</title>
      <link href="/one_hour/2018/02/07/js%E9%87%8C%E7%9A%84this/"/>
      <url>/one_hour/2018/02/07/js%E9%87%8C%E7%9A%84this/</url>
      
        <content type="html"><![CDATA[<h3 id="计划内容"><a href="#计划内容" class="headerlink" title="计划内容"></a>计划内容</h3><ul><li>bind</li><li>es5里的，es6里的</li></ul><h3 id="默认绑定"><a href="#默认绑定" class="headerlink" title="默认绑定"></a>默认绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非严格模式下，this指向全局对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);  <span class="comment">// window/global</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 严格模式下，this指向undefined</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);  <span class="comment">// undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 作为对象方法调用时，this指向该对象</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">sayHi</span>();  <span class="comment">// &#x27;张三&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：方法单独使用会丢失this</span></span><br><span class="line"><span class="keyword">const</span> say = obj.<span class="property">sayHi</span>;</span><br><span class="line"><span class="title function_">say</span>();  <span class="comment">// undefined，this指向全局</span></span><br></pre></td></tr></table></figure><h3 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a>显式绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// call/apply/bind 可以指定this</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span> &#125;;</span><br><span class="line">greet.<span class="title function_">call</span>(person);    <span class="comment">// &#x27;李四&#x27;</span></span><br><span class="line">greet.<span class="title function_">apply</span>(person);   <span class="comment">// &#x27;李四&#x27;</span></span><br><span class="line">greet.<span class="title function_">bind</span>(person)();  <span class="comment">// &#x27;李四&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="new绑定"><a href="#new绑定" class="headerlink" title="new绑定"></a>new绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造函数中的this指向新创建的实例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;王五&#x27;</span>);  <span class="comment">// this指向p</span></span><br></pre></td></tr></table></figure><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>箭头函数没有自己的this，它的this继承自外层作用域的this。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHi</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);  <span class="comment">// undefined，this指向全局</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">sayHi</span>();  <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>假如想要在sayHi里读取到obj的name</p><ol><li>使用普通函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHi</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);  <span class="comment">// &#x27;张三&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">sayHi</span>();  <span class="comment">// &#x27;张三&#x27;</span></span><br></pre></td></tr></table></figure></li><li>保存外部引用<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;赵六&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHi</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>);  <span class="comment">// 直接引用obj</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><ul><li>new绑定</li><li>显式绑定（call&#x2F;apply&#x2F;bind）</li><li>隐式绑定（对象方法）</li><li>默认绑定（全局&#x2F;undefined）</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> this </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js闭包</title>
      <link href="/one_hour/2018/02/07/js%E9%97%AD%E5%8C%85/"/>
      <url>/one_hour/2018/02/07/js%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h3 id="计划内容"><a href="#计划内容" class="headerlink" title="计划内容"></a>计划内容</h3><ul><li>经典问题for循环</li><li>函数式编程、柯里化</li></ul><h3 id="闭包（Closure）简介"><a href="#闭包（Closure）简介" class="headerlink" title="闭包（Closure）简介"></a>闭包（Closure）简介</h3><p>闭包是函数与其词法环境的组合。函数能访问定义时所在作用域的变量，即便在其外部被调用，这就是闭包的核心。</p><h3 id="经典问题：for-循环与闭包"><a href="#经典问题：for-循环与闭包" class="headerlink" title="经典问题：for 循环与闭包"></a>经典问题：for 循环与闭包</h3><p>问题：用 var 的 for 创建回调，会发现回调打印的都是循环结束后的 i 值。</p><p>示例（有问题）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> funcs = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  funcs.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(i); &#125;);</span><br><span class="line">&#125;</span><br><span class="line">funcs.<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> <span class="title function_">f</span>()); <span class="comment">// 输出 3 3 3</span></span><br></pre></td></tr></table></figure><p>解决方式：</p><ol><li>使用 let（块级作用域）：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> funcs = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  funcs.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(i); &#125;);</span><br><span class="line">&#125;</span><br><span class="line">funcs.<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> <span class="title function_">f</span>()); <span class="comment">// 输出 0 1 2</span></span><br></pre></td></tr></table></figure><ol start="2"><li>使用 IIFE（立即调用函数表达式）创造闭包：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> funcs = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span>(<span class="params">j</span>)&#123;</span><br><span class="line">    funcs.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(j); &#125;);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line">funcs.<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> <span class="title function_">f</span>()); <span class="comment">// 输出 0 1 2</span></span><br></pre></td></tr></table></figure><ol start="3"><li>使用函数工厂：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeLogger</span>(<span class="params">j</span>)&#123; <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(j); &#125;; &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  funcs.<span class="title function_">push</span>(<span class="title function_">makeLogger</span>(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="函数式编程与柯里化（Currying）"><a href="#函数式编程与柯里化（Currying）" class="headerlink" title="函数式编程与柯里化（Currying）"></a>函数式编程与柯里化（Currying）</h3><p>柯里化是把多个参数的函数转换为一系列单参数函数的技术，便于部分应用和复用。</p><p>例：手动柯里化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> add5 = <span class="title function_">add</span>(<span class="number">5</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add5</span>(<span class="number">3</span>)); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><p>通用柯里化辅助：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= fn.<span class="property">length</span>) <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...more</span>) &#123; <span class="keyword">return</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args.<span class="title function_">concat</span>(more)); &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a,b,c</span>)&#123; <span class="keyword">return</span> a+b+c; &#125;</span><br><span class="line"><span class="keyword">const</span> cs = <span class="title function_">curry</span>(sum);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">cs</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><p>应用场景</p><p>事件处理器生成、配置化函数、部分应用（预设常用参数）。<br>用闭包保存私有状态（例如计数器、缓存、惰性初始化）。</p><p>注意事项</p><p>闭包会保留外部变量的引用，可能导致内存无法及时释放，避免无意中持有大量数据。<br>在循环或大量创建闭包时考虑性能与内存。</p><p>小结</p><p>闭包是强大的工具：解决异步&#x2F;回调作用域问题，实现数据封装与函数式模式（如柯里化、部分应用）。合理使用 let、IIFE 和函数工厂能避免常见陷阱</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> 闭包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>事件流</title>
      <link href="/one_hour/2018/02/07/%E4%BA%8B%E4%BB%B6%E6%B5%81/"/>
      <url>/one_hour/2018/02/07/%E4%BA%8B%E4%BB%B6%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<ul><li>冒泡</li><li>捕获</li><li>target、currentTarget</li></ul><h3 id="事件流简介"><a href="#事件流简介" class="headerlink" title="事件流简介"></a>事件流简介</h3><p>浏览器事件有三个阶段：</p><ol><li>捕获（capturing）：从 window 向目标元素向下传播（很少用）。</li><li>目标（target）：到达目标元素并触发其监听器。</li><li>冒泡（bubbling）：从目标元素向上冒泡到 window（大多数事件支持冒泡）.</li></ol><p>默认 addEventListener 注册的监听器在冒泡阶段触发。可通过第三个参数切换到捕获阶段或传入配置对象。</p><p>示例：捕获 vs 冒泡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outer&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> outer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;outer&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 捕获阶段监听</span></span></span><br><span class="line"><span class="language-javascript">outer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;outer capture&#x27;</span>), &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;);</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 冒泡阶段监听</span></span></span><br><span class="line"><span class="language-javascript">outer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;outer bubble&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;button handler&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>target 与 currentTarget</p><ul><li>event.target：事件最初的触发源（可能是子元素）。</li><li>event.currentTarget：当前正在处理事件的元素（监听器绑定的元素）.</li></ul><p>停止传播</p><ul><li>event.stopPropagation()：阻止后续的捕获或冒泡。</li><li>event.stopImmediatePropagation()：还会阻止当前元素上后续的其他监听器执行。</li></ul><p>事件委托（推荐）<br>把子元素的事件处理器绑定到父元素，利用冒泡统一处理，减少监听器数量。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 委托示例：处理多个 .item 的点击</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#list&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> item = e.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">&#x27;.item&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!item) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// 处理 item</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>监听器选项（常用）</p><ul><li>capture: true&#x2F;false（捕获或冒泡）</li><li>once: true（自动只触发一次后移除）</li><li>passive: true（提示浏览器不会调用 preventDefault，用于触摸&#x2F;滚动性能）</li></ul><p>示例：被动监听器</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, onTouch, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure><p>（passive:true 时调用 e.preventDefault() 无效）</p><p>实用建议</p><ul><li>优先使用事件委托处理大量相似子元素的事件。</li><li>仅在需要时使用捕获。</li><li>在触摸&#x2F;滚动事件上考虑 passive 提升性能。</li><li>使用 stopPropagation&#x2F;stopImmediatePropagation 小心，避免破坏委托和第三方库逻辑。</li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> 事件流 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基础算法</title>
      <link href="/one_hour/2018/02/07/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/"/>
      <url>/one_hour/2018/02/07/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<ul><li>快速排序</li></ul><h3 id="常见基础算法速览（简明）"><a href="#常见基础算法速览（简明）" class="headerlink" title="常见基础算法速览（简明）"></a>常见基础算法速览（简明）</h3><ul><li>快速排序（Quick Sort）<ul><li>思路：分治，选基准 pivot，把数组分为小于 pivot &#x2F; 等于 &#x2F; 大于，然后递归排序。</li><li>平均时间复杂度：O(n log n)，最坏 O(n^2)（可随机化或三数取中减少概率）。</li><li>原地实现常用，空间 O(log n) 递归栈。</li></ul></li></ul><p>示例（JS）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">quickSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.<span class="property">length</span> &lt;= <span class="number">1</span>) <span class="keyword">return</span> arr;</span><br><span class="line">  <span class="keyword">const</span> pivot = arr[<span class="title class_">Math</span>.<span class="title function_">floor</span>(arr.<span class="property">length</span> / <span class="number">2</span>)];</span><br><span class="line">  <span class="keyword">const</span> left = [], mid = [], right = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> x <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; pivot) left.<span class="title function_">push</span>(x);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x === pivot) mid.<span class="title function_">push</span>(x);</span><br><span class="line">    <span class="keyword">else</span> right.<span class="title function_">push</span>(x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">quickSort</span>(left).<span class="title function_">concat</span>(mid, <span class="title function_">quickSort</span>(right));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>归并排序（Merge Sort）</p><ul><li>思路：分而治之，递归拆半，合并时做有序合并。</li><li>时间复杂度：O(n log n)，稳定；空间复杂度 O(n)。</li></ul></li><li><p>堆排序（Heap Sort）</p><ul><li>利用二叉堆（最大堆）选择最大元素，原地排序，时间 O(n log n)，不稳定。</li></ul></li><li><p>二分查找（Binary Search）</p><ul><li>前提：有序数组。</li><li>时间复杂度：O(log n)。</li></ul></li></ul><p>示例（JS，迭代）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">binarySearch</span>(<span class="params">arr, target</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> l = <span class="number">0</span>, r = arr.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">    <span class="keyword">const</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (arr[m] === target) <span class="keyword">return</span> m;</span><br><span class="line">    <span class="keyword">if</span> (arr[m] &lt; target) l = m + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> r = m - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>图的遍历：DFS &#x2F; BFS</p><ul><li>DFS（深度优先）：递归或栈实现，适合拓扑、连通性、回溯问题。</li><li>BFS（宽度优先）：队列实现，适合最短步数（无权图）。</li></ul></li><li><p>常见数据结构速记</p><ul><li>数组、链表、栈、队列、哈希表（Map&#x2F;Set）、二叉树、堆、并查集、Trie、图（邻接表&#x2F;矩阵）。</li></ul></li><li><p>算法复杂度与常见陷阱</p><ul><li>关注时间复杂度与空间复杂度，注意常数项与递归深度。</li><li>输入规模边界（空集、重复、大量重复值、极端有序&#x2F;逆序）要单独考虑。</li><li>优先写清晰正确的解法，再考虑微观优化（位运算、预分配、原地变更）。</li></ul></li><li><p>练习建议</p><ul><li>从经典题目入手：排序、二分、滑动窗口、哈希映射、DFS&#x2F;BFS、双指针、动态规划基础。</li><li>理解常用模板（递归、二分、滑窗口、前缀和、差分、堆）并能变形应用。</li></ul></li></ul><p>小结：掌握排序、查找、图遍历与基本数据结构，理解复杂度与边界情况，是攻克中等算法题的基石。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack注意事项</title>
      <link href="/one_hour/2018/02/07/webpack%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/one_hour/2018/02/07/webpack%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<h3 id="计划写的内容"><a href="#计划写的内容" class="headerlink" title="计划写的内容"></a>计划写的内容</h3><ul><li>publicPath</li><li>outputPath</li><li>contentBase</li><li>webpack runtime code </li><li>等</li></ul><h3 id="Webpack配置核心概念"><a href="#Webpack配置核心概念" class="headerlink" title="Webpack配置核心概念"></a>Webpack配置核心概念</h3><h4 id="1-路径配置"><a href="#1-路径配置" class="headerlink" title="1. 路径配置"></a>1. 路径配置</h4><h5 id="publicPath（公共路径）"><a href="#publicPath（公共路径）" class="headerlink" title="publicPath（公共路径）"></a>publicPath（公共路径）</h5><ul><li>作用：指定资源的访问路径前缀</li><li>配置位置：output.publicPath<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/assets/&#x27;</span>, <span class="comment">// 生产环境</span></span><br><span class="line">  <span class="comment">// publicPath: &#x27;/&#x27;, // 开发环境</span></span><br><span class="line">  <span class="comment">// publicPath: &#x27;https://cdn.example.com/&#x27; // CDN环境</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="outputPath（输出路径）"><a href="#outputPath（输出路径）" class="headerlink" title="outputPath（输出路径）"></a>outputPath（输出路径）</h5><ul><li>作用：指定打包文件的输出目录</li><li>配置位置：output.path<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="contentBase（开发服务器静态资源目录）"><a href="#contentBase（开发服务器静态资源目录）" class="headerlink" title="contentBase（开发服务器静态资源目录）"></a>contentBase（开发服务器静态资源目录）</h5><ul><li>作用：配置开发服务器的静态资源访问</li><li>配置位置：devServer.contentBase<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">contentBase</span>: path.<span class="title function_">join</span>(dirname, <span class="string">&#x27;public&#x27;</span>),</span><br><span class="line">  <span class="comment">// 支持多个静态资源目录</span></span><br><span class="line">  <span class="attr">contentBase</span>: [</span><br><span class="line">      path.<span class="title function_">join</span>(dirname, <span class="string">&#x27;public&#x27;</span>),</span><br><span class="line">      path.<span class="title function_">join</span>(dirname, <span class="string">&#x27;assets&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-Webpack-Runtime-Code"><a href="#2-Webpack-Runtime-Code" class="headerlink" title="2. Webpack Runtime Code"></a>2. Webpack Runtime Code</h4><h5 id="运行时代码"><a href="#运行时代码" class="headerlink" title="运行时代码"></a>运行时代码</h5><ul><li>作用：管理模块的加载和依赖关系</li><li>优化方案:<ul><li>使用SplitChunksPlugin</li><li>使用DllPlugin</li><li>使用externals</li><li>使用import()</li><li>使用require.ensure</li><li>使用require.include</li><li>使用require.ensure</li><li>使用require.include</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 提取运行时代码</span></span><br><span class="line">    <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;runtime&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 持久化缓存</span></span><br><span class="line">    <span class="attr">moduleIds</span>: <span class="string">&#x27;deterministic&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkIds</span>: <span class="string">&#x27;deterministic&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-常见优化配置"><a href="#3-常见优化配置" class="headerlink" title="3. 常见优化配置"></a>3. 常见优化配置</h4><h5 id="1-分包策略"><a href="#1-分包策略" class="headerlink" title="1. 分包策略"></a>1. 分包策略</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">20000</span>,</span><br><span class="line">      <span class="attr">minRemainingSize</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">maxAsyncRequests</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">automaticNameDelimiter</span>: <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">      <span class="attr">enforceSizeThreshold</span>: <span class="number">50000</span>,</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">vendors</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-缓存优化"><a href="#2-缓存优化" class="headerlink" title="2. 缓存优化"></a>2. 缓存优化</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].[contenthash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].[contenthash].chunk.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 持久化缓存</span></span><br><span class="line">  <span class="attr">cache</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;filesystem&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-开发体验优化"><a href="#3-开发体验优化" class="headerlink" title="3. 开发体验优化"></a>3. 开发体验优化</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 热更新</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>, <span class="comment">// gzip压缩</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123; <span class="comment">// 接口代理</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;<span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-常见问题解决"><a href="#4-常见问题解决" class="headerlink" title="4. 常见问题解决"></a>4. 常见问题解决</h4><h5 id="1-路径问题"><a href="#1-路径问题" class="headerlink" title="1. 路径问题"></a>1. 路径问题</h5><ul><li>publicPath配置不当导致资源404</li><li>开发环境和生产环境路径不一致</li><li>静态资源访问路径错误</li></ul><h5 id="2-缓存问题"><a href="#2-缓存问题" class="headerlink" title="2. 缓存问题"></a>2. 缓存问题</h5><ul><li>文件名hash不更新</li><li>浏览器缓存未清除</li><li>运行时代码频繁变化</li></ul><h5 id="3-性能问题"><a href="#3-性能问题" class="headerlink" title="3. 性能问题"></a>3. 性能问题</h5><ul><li>包体积过大</li><li>首屏加载慢</li><li>重复打包</li></ul><h4 id="5-最佳实践"><a href="#5-最佳实践" class="headerlink" title="5. 最佳实践"></a>5. 最佳实践</h4><ol><li><strong>路径配置</strong></li></ol><ul><li>开发环境使用相对路径</li><li>生产环境根据部署策略配置</li><li>CDN路径配置时注意版本控制</li></ul><ol start="2"><li><strong>缓存策略</strong></li></ol><ul><li>合理使用contenthash</li><li>提取运行时代码</li><li>配置持久化缓存</li></ul><ol start="3"><li><strong>开发优化</strong></li></ol><ul><li>启用热更新</li><li>配置合适的source-map</li><li>使用webpack-bundle-analyzer分析包体积</li></ul><h3 id="Webpack运行原理及中间件实现"><a href="#Webpack运行原理及中间件实现" class="headerlink" title="Webpack运行原理及中间件实现"></a>Webpack运行原理及中间件实现</h3><h4 id="1-Webpack运行原理"><a href="#1-Webpack运行原理" class="headerlink" title="1. Webpack运行原理"></a>1. Webpack运行原理</h4><h5 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简化版的webpack工作流程</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Webpack</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line"><span class="comment">// 定义各个生命周期钩子</span></span><br><span class="line"><span class="attr">run</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>(),</span><br><span class="line"><span class="attr">emit</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>(),</span><br><span class="line"><span class="attr">done</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>()</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 1. 读取入口文件</span></span><br><span class="line"><span class="keyword">const</span> entry = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">entry</span>;</span><br><span class="line"><span class="comment">// 2. 解析依赖</span></span><br><span class="line"><span class="keyword">const</span> dependencies = <span class="variable language_">this</span>.<span class="title function_">parse</span>(entry);</span><br><span class="line"><span class="comment">// 3. 转换代码</span></span><br><span class="line"><span class="keyword">const</span> transformedCode = <span class="variable language_">this</span>.<span class="title function_">transform</span>(dependencies);</span><br><span class="line"><span class="comment">// 4. 生成bundle</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">emit</span>(transformedCode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="中间件机制"><a href="#中间件机制" class="headerlink" title="中间件机制"></a>中间件机制</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Webpack中间件实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebpackMiddleware</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">middlewares</span> = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">use</span>(<span class="params">middleware</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="title function_">push</span>(middleware);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">execute</span>(<span class="params">context</span>) &#123;</span><br><span class="line"><span class="comment">// 洋葱模型实现</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">dispatch</span> = <span class="keyword">async</span> (<span class="params">i</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (i === <span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">const</span> middleware = <span class="variable language_">this</span>.<span class="property">middlewares</span>[i];</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">middleware</span>(context, <span class="function">() =&gt;</span> <span class="title function_">dispatch</span>(i + <span class="number">1</span>));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">dispatch</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-自定义Webpack中间件示例"><a href="#2-自定义Webpack中间件示例" class="headerlink" title="2. 自定义Webpack中间件示例"></a>2. 自定义Webpack中间件示例</h4><ul><li>通过tapAsync或tap注册到具体的钩子上</li><li>处理完成后调用callback()继续下一个中间件</li><li>同步操作用tap</li><li>回调式异步用tapAsync</li><li>Promise式异步用tapPromise<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 文件处理中间件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fileProcessMiddleware</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">async</span> (context, next) =&gt; &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;开始处理文件&#x27;</span>);</span><br><span class="line"><span class="comment">// 处理文件逻辑</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件处理完成&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用中间件</span></span><br><span class="line"><span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">WebpackMiddleware</span>();</span><br><span class="line">compiler.<span class="title function_">use</span>(<span class="title function_">fileProcessMiddleware</span>());</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 标准的Webpack中间件写法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMiddleware</span> &#123;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">        <span class="comment">// 在不同的钩子上注册处理函数</span></span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">beforeCompile</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;MyMiddleware&#x27;</span>, <span class="function">(<span class="params">params, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 在这里处理beforeCompile阶段的逻辑</span></span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;MyMiddleware&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 在这里处理emit阶段的逻辑</span></span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用中间件</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="comment">// webpack配置</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MyMiddleware</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Webpack插件标准写法（使用apply）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebpackPlugin</span> &#123;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;MyPlugin&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 处理逻辑</span></span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 函数式中间件写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">webpackMiddleware</span> = (<span class="params">compiler</span>) =&gt; &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;MyMiddleware&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 处理逻辑</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用Generator的中间件写法</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">webpackMiddleware</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// 在不同阶段执行</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;MyMiddleware&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 处理逻辑</span></span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 简单函数写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">simpleMiddleware</span> = (<span class="params">options</span>) =&gt; <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理逻辑</span></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web常见的安全问题</title>
      <link href="/one_hour/2018/02/07/web%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>/one_hour/2018/02/07/web%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<ul><li>xss</li><li>csrf</li><li>等</li><li>解决方法</li></ul><h3 id="Web安全问题及防范"><a href="#Web安全问题及防范" class="headerlink" title="Web安全问题及防范"></a>Web安全问题及防范</h3><h4 id="1-XSS（跨站脚本攻击）"><a href="#1-XSS（跨站脚本攻击）" class="headerlink" title="1. XSS（跨站脚本攻击）"></a>1. XSS（跨站脚本攻击）</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><ul><li>攻击者将恶意脚本注入到网页中</li><li>当用户访问页面时，恶意脚本被执行</li><li>可能窃取用户信息、篡改页面内容等</li></ul><h5 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h5><ol><li><strong>存储型XSS</strong></li></ol><ul><li>恶意脚本存储在服务器端</li><li>用户提交数据时，恶意脚本被存储</li><li>其他用户访问页面时，恶意脚本被执行<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：用户评论中包含恶意脚本</span></span><br><span class="line"><span class="keyword">const</span> comment = <span class="string">&#x27;&lt;script&gt;alert(&quot;已窃取cookie:&quot; + document.cookie)&lt;/script&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><p><strong>反射型XSS</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：用户点击恶意链接，恶意脚本被反射到页面</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://example.com?comment=&lt;script&gt;alert(&quot;已窃取cookie:&quot; + document.cookie)&lt;/script&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>DOM型XSS</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：用户输入恶意脚本，直接在DOM中执行</span></span><br><span class="line"><span class="keyword">const</span> input = <span class="string">&#x27;&lt;script&gt;alert(&quot;已窃取cookie:&quot; + document.cookie)&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span> = input;</span><br></pre></td></tr></table></figure></li></ol><h5 id="防范措施"><a href="#防范措施" class="headerlink" title="防范措施"></a>防范措施</h5><ol><li><p>输入过滤</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 过滤特殊字符，如&lt;、&gt;、script等</span></span><br><span class="line"><span class="keyword">const</span> input = input.<span class="title function_">replace</span>(<span class="regexp">/&lt;|&gt;/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>输出编码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将用户输入的数据进行编码，如HTML实体编码</span></span><br><span class="line"><span class="keyword">const</span> comment = comment.<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>使用CSP（内容安全策略）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限制允许执行的脚本类型</span></span><br><span class="line"><span class="keyword">const</span> cspHeader = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; https://apis.example.com&quot;</span>;</span><br></pre></td></tr></table></figure></li></ol><h4 id="2-CSRF（跨站请求伪造）"><a href="#2-CSRF（跨站请求伪造）" class="headerlink" title="2. CSRF（跨站请求伪造）"></a>2. CSRF（跨站请求伪造）</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><ul><li>攻击者诱导用户访问恶意网站</li><li>利用用户已登录的身份发起请求</li><li>在用户不知情的情况下执行操作</li></ul><h5 id="攻击示例"><a href="#攻击示例" class="headerlink" title="攻击示例"></a>攻击示例</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 恶意网站中的图片 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://bank.example.com/transfer?amount=1000&amp;to=attacker&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><h5 id="防范措施-1"><a href="#防范措施-1" class="headerlink" title="防范措施"></a>防范措施</h5><ol><li>CSRF Token<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端生成token</span></span><br><span class="line"><span class="keyword">const</span> csrfToken = <span class="title function_">generateToken</span>();</span><br><span class="line"><span class="comment">// 在表单中包含token</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;csrfToken&#125;&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li>Same-Site Cookie<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置Cookie</span></span><br><span class="line"><span class="title class_">Set</span>-<span class="title class_">Cookie</span>: sessionId=abc123; <span class="title class_">SameSite</span>=<span class="title class_">Strict</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="3-SQL注入"><a href="#3-SQL注入" class="headerlink" title="3. SQL注入"></a>3. SQL注入</h4><h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><ul><li>将SQL命令插入到输入字段中</li><li>破坏原有SQL语句结构</li><li>执行恶意SQL命令</li></ul><h5 id="攻击示例-1"><a href="#攻击示例-1" class="headerlink" title="攻击示例"></a>攻击示例</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span></span><br><span class="line"><span class="comment">-- 原始查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;input&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line"><span class="comment">-- 注入后</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span><span class="comment">--&#x27; AND password = &#x27;anything&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="4-其他安全问题"><a href="#4-其他安全问题" class="headerlink" title="4. 其他安全问题"></a>4. 其他安全问题</h4><h5 id="1-点击劫持"><a href="#1-点击劫持" class="headerlink" title="1. 点击劫持"></a>1. 点击劫持</h5><p>防范：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置X-Frame-Options</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;X-Frame-Options&#x27;</span>, <span class="string">&#x27;DENY&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="2-中间人攻击"><a href="#2-中间人攻击" class="headerlink" title="2. 中间人攻击"></a>2. 中间人攻击</h5><p>防范：</p><ul><li>使用HTTPS</li><li>证书校验</li><li>HSTS策略</li></ul><h5 id="3-文件上传漏洞"><a href="#3-文件上传漏洞" class="headerlink" title="3. 文件上传漏洞"></a>3. 文件上传漏洞</h5><p>防范：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限制文件类型和大小</span></span><br><span class="line"><span class="keyword">const</span> allowedTypes = [<span class="string">&#x27;image/jpeg&#x27;</span>, <span class="string">&#x27;image/png&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> maxSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 1MB</span></span><br></pre></td></tr></table></figure><h4 id="5-安全最佳实践"><a href="#5-安全最佳实践" class="headerlink" title="5. 安全最佳实践"></a>5. 安全最佳实践</h4><ol><li><strong>通用防护措施</strong></li></ol><ul><li>及时更新依赖包</li><li>使用安全的框架</li><li>开启安全相关的HTTP头部</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常用安全头部</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">helmet</span>()); <span class="comment">// 使用helmet中间件</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>身份认证</strong></li></ol><ul><li>使用强密码策略</li><li>实现登录失败次数限制</li><li>双因素认证</li></ul><ol start="3"><li><strong>数据保护</strong></li></ol><ul><li>敏感数据加密存储</li><li>使用HTTPS传输</li><li>实现适当的访问控制</li></ul><ol start="4"><li><strong>日志监控</strong></li></ol><ul><li>记录所有安全事件</li><li>定期审计日志</li><li>实现实时监控和报警</li></ul>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在浏览器输入URL后发生了什么</title>
      <link href="/one_hour/2018/02/07/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5URL%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"/>
      <url>/one_hour/2018/02/07/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5URL%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<ul><li>相对路径、绝对路径</li><li>http(请求头、状态码)</li><li>dns</li><li>tcp三次握手</li></ul><h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>用户在浏览器输入 URL（或点击链接）后，浏览器会把高层的“请求页面”行为拆成若干步骤：解析 URL、DNS 查询、建立传输层连接（TCP &#x2F; TLS）、发送 HTTP 请求、接收响应后处理缓存与重定向、下载资源并执行解析&#x2F;渲染、最终呈现并触发页面事件（DOMContentLoaded、load）。下面按序简要说明要点与常见优化点。</p><h3 id="1-URL-与路径解析"><a href="#1-URL-与路径解析" class="headerlink" title="1. URL 与路径解析"></a>1. URL 与路径解析</h3><ul><li>绝对 URL：包含协议、主机和路径（如 <a href="https://example.com/path%EF%BC%89%E3%80%82">https://example.com/path）。</a></li><li>相对 URL：基于当前文档的 location 或 <base> 标签解析（如 ..&#x2F;img.png）。</li><li>协议相对（&#x2F;&#x2F;example.com）继承当前协议（较少用）。</li><li>路径解析影响请求 Host、Referer、同源策略。</li></ul><h3 id="2-DNS-解析"><a href="#2-DNS-解析" class="headerlink" title="2. DNS 解析"></a>2. DNS 解析</h3><ul><li>浏览器&#x2F;操作系统首先查询域名到 IP：先查本地缓存，再系统 DNS 缓存&#x2F;hosts、最后向递归 DNS 服务器查询。</li><li>可以被 DNS 缓存、CDN 和解析加速（DNS 预解析 dns-prefetch）.</li></ul><h3 id="3-建立连接：TCP-三次握手"><a href="#3-建立连接：TCP-三次握手" class="headerlink" title="3. 建立连接：TCP 三次握手"></a>3. 建立连接：TCP 三次握手</h3><ul><li>客户端发送 SYN -&gt; 服务器 SYN+ACK -&gt; 客户端 ACK，建立可靠连接。</li><li>之后可通过该连接发送请求（TCP 有拥塞控制、慢启动）。</li><li>HTTP&#x2F;1.1 通常复用 keep-alive 连接；HTTP&#x2F;2 在单连接上多路复用多个请求。</li></ul><h3 id="4-TLS（HTTPS）握手（若使用-https）"><a href="#4-TLS（HTTPS）握手（若使用-https）" class="headerlink" title="4. TLS（HTTPS）握手（若使用 https）"></a>4. TLS（HTTPS）握手（若使用 https）</h3><ul><li>在 TCP 建立后进行 TLS 握手：协商协议版本、交换证书、公钥，生成对称密钥。</li><li>握手完成后加密的应用层数据传输开始（会增加连接延迟，通常通过 TLS 复用、session resumption 优化）.</li></ul><h3 id="5-发送-HTTP-请求"><a href="#5-发送-HTTP-请求" class="headerlink" title="5. 发送 HTTP 请求"></a>5. 发送 HTTP 请求</h3><ul><li>客户端构造请求行 + 请求头（Host、User-Agent、Accept、Cookie、Referer 等），然后可有请求体（POST&#x2F;PUT）。</li><li>示例（简略）：<br>GET &#x2F;path&#x2F;resource HTTP&#x2F;1.1<br>Host: example.com<br>Accept: text&#x2F;html</li><li>可能遇到重定向（3xx）或鉴权（401&#x2F;403）.</li></ul><h3 id="6-服务端响应与状态码"><a href="#6-服务端响应与状态码" class="headerlink" title="6. 服务端响应与状态码"></a>6. 服务端响应与状态码</h3><ul><li>响应包含状态码、响应头、以及可选的响应体。</li><li>常见状态码：200（成功）、301&#x2F;302（重定向）、304（未修改，使用缓存）、4xx（客户端错误）、5xx（服务器错误）。</li><li>缓存相关头：Cache-Control、Expires、ETag、Last-Modified。若命中 304，浏览器可使用本地缓存资源。</li></ul><h3 id="7-浏览器接收响应与缓存策略"><a href="#7-浏览器接收响应与缓存策略" class="headerlink" title="7. 浏览器接收响应与缓存策略"></a>7. 浏览器接收响应与缓存策略</h3><ul><li>浏览器依据响应头决定是否缓存、如何验证缓存（协商缓存：If-Modified-Since &#x2F; If-None-Match）。</li><li>Service Worker 可拦截请求并自定义缓存&#x2F;离线策略。</li><li>CDN 可在边缘缓存静态资源减少延迟。</li></ul><h3 id="8-浏览器解析与渲染流水线"><a href="#8-浏览器解析与渲染流水线" class="headerlink" title="8. 浏览器解析与渲染流水线"></a>8. 浏览器解析与渲染流水线</h3><ul><li>HTML -&gt; 解析器构建 DOM 树。</li><li>CSS -&gt; 构建 CSSOM。</li><li>DOM + CSSOM -&gt; 合成 render tree（只包含可见节点）。</li><li>Layout（reflow）：计算每个节点的几何位置与大小。</li><li>Paint：把节点绘制成图层像素。</li><li>Composite：合并图层到屏幕。</li><li>JS 脚本会在解析 HTML 时执行（普通 <script> 会阻塞解析；使用 async/defer 可避免阻塞或推迟执行）。</li><li>图片、脚本、样式表是外部资源，按优先级并行/串行下载（受同源并发限制、HTTP/2 多路复用影响）.</li></ul><h3 id="9-页面生命周期事件与指标"><a href="#9-页面生命周期事件与指标" class="headerlink" title="9. 页面生命周期事件与指标"></a>9. 页面生命周期事件与指标</h3><ul><li>DOMContentLoaded：DOM 构建完成且无需等待样式/图片完成（脚本阻塞则会延迟）。</li><li>load：页面所有资源完成加载。</li><li>性能指标：FP（First Paint）、FCP（First Contentful Paint）、LCP（Largest Contentful Paint）、TTI（Time to Interactive）.</li></ul><h3 id="10-优化与工程实践要点"><a href="#10-优化与工程实践要点" class="headerlink" title="10. 优化与工程实践要点"></a>10. 优化与工程实践要点</h3><ul><li>合理使用 CDN 与缓存策略，减少 DNS/连接/首字节延迟（TTFB）。</li><li>使用 HTTP/2/3 减少连接成本、多路复用与头部压缩。</li><li>减少阻塞脚本，使用 async/defer，优先加载关键 CSS（critical CSS）。</li><li>合并/压缩资源，使用图片现代格式与响应式图片，启用 gzip/brotli 压缩。</li><li>使用 Prefetch、Preconnect、DNS-Prefetch、Preload 等 hint 优化关键资源加载。</li><li>在调试时用 DevTools Network 面板：查看请求/响应头、时间线、缓存命中、重定向链。</li></ul><h3 id="11-安全与协议相关"><a href="#11-安全与协议相关" class="headerlink" title="11. 安全与协议相关"></a>11. 安全与协议相关</h3><ul><li>同源策略限制跨域 JS/DOM 访问；CORS 决定跨域资源是否可被脚本访问。</li><li>HTTPS 保证传输加密与证书验证；HSTS 强制 HTTPS。</li><li>Cookie/Set-Cookie 头与 SameSite、HttpOnly、Secure 等影响安全与跨站行为。</li></ul><p>小结<br>用户在地址栏输入 URL 后的流程是多阶段、跨层（DNS → 传输 → 应用 → 渲染）的流水线。理解每一层的延迟来源与优化手段（DNS、连接、TLS、TTFB、渲染阻塞）有助于定位性能瓶颈并改进用户体验。</p>]]></content>
      
      
      <categories>
          
          <category> 科普 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片格式的区别</title>
      <link href="/one_hour/2018/02/07/%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/one_hour/2018/02/07/%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<ul><li>png（还分几位)</li><li>jpg</li><li>jpeg</li><li>gif</li></ul><h3 id="常见图片格式对比（简明"><a href="#常见图片格式对比（简明" class="headerlink" title="常见图片格式对比（简明)"></a>常见图片格式对比（简明)</h3><ul><li><p>PNG</p><ul><li>特点：无损压缩，支持真彩色（24bit&#x2F;32bit）与 alpha 透明（PNG-24&#x2F;PNG-32）；也有索引色的 PNG-8（256 色）。</li><li>适用：带透明背景的图像、矢量导出后的位图、需要无损的界面元素、截图（保留文本清晰）。</li><li>缺点：同等视觉质量下体积通常大于有损格式（照片类）.</li></ul></li><li><p>JPG &#x2F; JPEG</p><ul><li>特点：有损压缩，适合连续色调和照片；支持渐进式（progressive）编码以提升首屏感知速度；不支持 alpha 透明。</li><li>适用：照片、风景、复杂色彩的图片。</li><li>缺点：反复有损压缩会损失细节；不适合带文字&#x2F;锐利边缘的图形.</li></ul></li><li><p>GIF</p><ul><li>特点：调色板限制（最多 256 色），支持帧动画（轻量动画常用）；无真彩色。</li><li>适用：短动画、低色数图标动画或兼容极老浏览器的需求。</li><li>缺点：颜色受限、体积效率差；静态图不推荐.</li></ul></li><li><p>SVG</p><ul><li>特点：矢量格式，基于 XML，可缩放无损；可内联、可交互、可动画（CSS&#x2F;JS）。</li><li>适用：图标、logo、图表、简单插图与响应式场景。</li><li>缺点：复杂照片不适合；需注意内联 JS&#x2F;CSS 的安全性与文件大小.</li></ul></li><li><p>WebP</p><ul><li>特点：Google 提出的现代格式，支持有损&#x2F;无损压缩和透明、动画，通常比 PNG&#x2F;JPEG 更小。</li><li>适用：网页图片优化首选之一（兼容性需检查或提供后备）。</li><li>缺点：部分老浏览器不支持，需提供回退格式或使用 <picture>。</li></ul></li><li><p>AVIF</p><ul><li>特点：基于 AV1 编码，压缩效率高（常优于 WebP），支持有损&#x2F;无损与透明。</li><li>适用：追求极致带宽节省的场景。</li><li>缺点：编码慢、编码工具&#x2F;浏览器支持逐步完善，需要回退策略。</li></ul></li><li><p>APNG &#x2F; 有关动画替代</p><ul><li>APNG &#x3D; PNG 的动画扩展，支持真彩色与透明，比 GIF 质量好，但兼容性需确认。</li><li>对于复杂动画可以考虑 WebP 动画或视频播放（mp4&#x2F;webm）以节省体积。</li></ul></li></ul><h3 id="什么时候用哪个（简要决策树）"><a href="#什么时候用哪个（简要决策树）" class="headerlink" title="什么时候用哪个（简要决策树）"></a>什么时候用哪个（简要决策树）</h3><ul><li>图标 &#x2F; logo &#x2F; 矢量图：SVG</li><li>需要透明（且为图形或界面元素）：PNG（或 WebP&#x2F;AVIF 支持时优先）</li><li>照片类：JPEG（或使用 WebP&#x2F;AVIF 以更小体积）</li><li>简单动画（低色数）：GIF；需质量&#x2F;透明且现代浏览器：WebP 动画 &#x2F; APNG</li><li>追求最佳压缩：优先考虑 AVIF -&gt; WebP -&gt; JPEG&#x2F;PNG 回退</li></ul><h3 id="实践建议"><a href="#实践建议" class="headerlink" title="实践建议"></a>实践建议</h3><ul><li>使用现代格式（WebP&#x2F;AVIF）并通过 <picture> 提供回退，或在构建链中做格式检测&#x2F;回退。</li><li>对照片使用质量调整（JPEG quality 70–85 常为折中）；对图形使用无损或 PNG-8（若色数允许）。</li><li>对 SVG 做精简（svgo），对位图做压缩（imagemagick &#x2F; mozjpeg &#x2F; cwebp &#x2F; svgo &#x2F; avifenc）。</li><li>使用响应式图片（srcset&#x2F;sizes）根据视口加载合适尺寸，避免过大图片浪费带宽。</li><li>考虑懒加载与 CDN 加速，保留正确的色彩配置与元数据（必要时移除以减小体积）。</li></ul><p>小结：根据图片类型（照片&#x2F;图形&#x2F;动画）、是否需要透明、兼容性和体积目标来选格式。优先用矢量保存可缩放资产；在带宽敏感场景下优先现代格式并做好回退与构建优化。</p>]]></content>
      
      
      <categories>
          
          <category> 科普 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css奇淫技巧</title>
      <link href="/one_hour/2018/02/07/css%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/"/>
      <url>/one_hour/2018/02/07/css%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h3 id="border实现三角小图标"><a href="#border实现三角小图标" class="headerlink" title="border实现三角小图标"></a>border实现三角小图标</h3><ul><li>原理<br>通过设置元素宽高为 0，然后利用四个边框（border）的宽度与颜色，其中将不需要的两条边设为透明，就能得到不同方向的三角形。因为边框会在元素为 0x0 时相互交汇，形成斜边。</li></ul><p>示例（向上三角）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tri-up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.tri-up</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-left</span>:<span class="number">10px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-right</span>:<span class="number">10px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-bottom</span>:<span class="number">10px</span> solid <span class="number">#333</span>; <span class="comment">/* 三角颜色 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他方向：</p><p>向下：把 border-top 设为有色，左右透明。<br>向左：把 border-right 设为有色，上下透明。<br>向右：把 border-left 设为有色，上下透明。<br>用在伪元素上（常用于提示箭头）：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>:relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">  <span class="attribute">content</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>:<span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">bottom</span>:-<span class="number">6px</span>; <span class="comment">/* 根据需要调整位置 */</span></span><br><span class="line">  <span class="attribute">width</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-left</span>:<span class="number">6px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-right</span>:<span class="number">6px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-top</span>:<span class="number">6px</span> solid <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.75</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>补充技巧：</p><p>用 em&#x2F;rem 可以做相对尺寸的三角，随文本缩放。<br>如果需要可抗锯齿的斜角效果，考虑用 clip-path 或 transform: rotate() 的正方形截取。</p><h3 id="display-none-visibility-hidden-区别，以及使用visibility实现神奇的效果"><a href="#display-none-visibility-hidden-区别，以及使用visibility实现神奇的效果" class="headerlink" title="display:none;visibility:hidden;区别，以及使用visibility实现神奇的效果"></a>display:none;visibility:hidden;区别，以及使用visibility实现神奇的效果</h3><h4 id="layout（布局）"><a href="#layout（布局）" class="headerlink" title="layout（布局）"></a>layout（布局）</h4><ul><li>display:none：元素从文档流中移除，不占用空间。</li><li>visibility:hidden：元素不可见，但保留原有占位空间。</li></ul><h4 id="交互与焦点"><a href="#交互与焦点" class="headerlink" title="交互与焦点"></a>交互与焦点</h4><ul><li>display:none 的元素无法被选中、点击或聚焦（不可交互）。</li><li>visibility:hidden 同样不可见且通常不可交互（也不能聚焦），但占位存在。</li></ul><h4 id="动画与过渡"><a href="#动画与过渡" class="headerlink" title="动画与过渡"></a>动画与过渡</h4><ul><li>display 属性不能过渡（无法平滑动画）。</li><li>visibility 可以与 opacity 联动，配合 transition 实现渐隐&#x2F;渐现效果（常用技巧）。</li></ul><p>渐显 &#x2F; 渐隐的常用实现（只用 CSS，无 JS 回调）：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.modal</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">visibility</span>:hidden;</span><br><span class="line">  <span class="attribute">transition</span>: opacity .<span class="number">25s</span> ease, visibility <span class="number">0s</span> linear .<span class="number">25s</span>; <span class="comment">/* 隐藏时延迟 visibility */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.modal</span><span class="selector-class">.show</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>:<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">visibility</span>:visible;</span><br><span class="line">  <span class="attribute">transition-delay</span>:<span class="number">0s</span>,<span class="number">0s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解释：当加上 .show，visibility 立刻变为 visible，opacity 过渡到 1；当移除 .show，opacity 先过渡到 0（.25s），visibility 在 0.25s 后才变为 hidden，从而实现平滑消失并在消失后移除占位&#x2F;交互。</p><p>pointer-events 辅助</p><p>有时希望元素不可见但仍阻止点击，可结合 pointer-events: none 或 auto。<br>表格折叠</p><p>visibility:collapse 对表格行&#x2F;列有特殊语义，可折叠格子（支持性检查）。</p><h4 id="实用场景举例"><a href="#实用场景举例" class="headerlink" title="实用场景举例"></a>实用场景举例</h4><p>想在页面保持布局不变但暂时隐藏某区域（例如保持栅格高度），使用 visibility:hidden。<br>想彻底移除元素（不占位、减少文档流影响），使用 display:none。<br>想做淡入淡出动画：用 visibility + opacity（并配合 transition-delay）或用 JS 在 transitionend 后再改 display。<br>小结</p><p>display 控制是否参与布局；visibility 控制是否可见但不影响布局空间。<br>动画用 visibility+opacity 比直接切换 display 更平滑；若需无缝交互控制，可配合 pointer-events 或在动画结束后用 JS 切换 display。</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 奇淫技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css基础属性解析</title>
      <link href="/one_hour/2018/02/07/css%E5%9F%BA%E7%A1%80%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90/"/>
      <url>/one_hour/2018/02/07/css%E5%9F%BA%E7%A1%80%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h3 id="块元素"><a href="#块元素" class="headerlink" title="块元素"></a>块元素</h3><pre><code>常见的`div、p、ul、li、ol、h1~h6、`特点：- 定义`width、height`有效### 行内元素`span、a、i`特点：- 定义`width、height`无效。- padding有效，margin只有左右的有效，上下的无效</code></pre><p>元素类型由以下两项定义：</p><ul><li><a href="https://www.w3.org/TR/html/dom.html#element-dfn-categories">Catagories</a></li><li><a href="https://www.w3.org/TR/html/dom.html#element-dfn-content-model">Content Model</a></li></ul><h3 id="元素包含规则"><a href="#元素包含规则" class="headerlink" title="元素包含规则"></a>元素包含规则</h3><p>由Content Model决定，</p><h3 id="Catagories"><a href="#Catagories" class="headerlink" title="Catagories"></a>Catagories</h3><h3 id="Content-Model"><a href="#Content-Model" class="headerlink" title="Content Model"></a>Content Model</h3><ul><li>text-align基于文本元素</li><li>line-height</li><li>vertical-align：设置元素的垂直对齐方式<br>该属性定义行内元素的基线相对于该元素所在行的基线的垂直对齐。允许指定负长度值和百分比值。这会使元素降低而不是升高。在表单元格中，这个属性会设置单元格框中的单元格内容的对齐方式。<br><img src= "/one_hour/img/loading.gif" data-src="/one_hour/images/vertical_align.jpeg" alt="image"></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><blockquote><p><a href="https://www.zhihu.com/question/48130783/answer/109271752">元素的使用姿势</a><br><a href="http://www.cnblogs.com/xiaohuochai/p/5271217.html">line-height 和vertical-align</a><br><a href="https://zhuanlan.zhihu.com/p/25808995">line-height 和vertical-align</a><br><a href="http://v.youku.com/v_show/id_XMzg4NDUzMDUy.html">字体设计的视频</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础属性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>页面布局</title>
      <link href="/one_hour/2018/02/07/%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80/"/>
      <url>/one_hour/2018/02/07/%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h3><p><img src= "/one_hour/img/loading.gif" data-src="/one_hour/images/box_pattern.jpeg" alt="box"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* content-box */</span></span><br><span class="line"><span class="attribute">box-sizing</span>:border-box;</span><br></pre></td></tr></table></figure><p>故名思议就是我们在页面定义<code>width</code>以及<code>height</code>的时候如何计算。<br>默认的模型<code>content-box</code>,即定义的就是content里的<code>width</code>、<code>height</code>.<br>IE里的诡异模型即<code>border-box</code>，即定义的<code>width = content+padding+border</code><br><code>height</code>同理。</p><h3 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h3><p><code>vertical-align</code>会失效</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">display</span>:flex;</span><br><span class="line"><span class="comment">/*flex:flex-grow,flex-shrink,flex-basis*/</span></span><br><span class="line"><span class="attribute">flex</span>: <span class="number">2</span> <span class="number">2</span> <span class="number">10%</span>;</span><br><span class="line"><span class="comment">/* 属性</span></span><br><span class="line"><span class="comment">flex-direction</span></span><br><span class="line"><span class="comment">flex-wrap</span></span><br><span class="line"><span class="comment">flex-flow</span></span><br><span class="line"><span class="comment">justify-content</span></span><br><span class="line"><span class="comment">align-items</span></span><br><span class="line"><span class="comment">align-content</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*作用于item</span></span><br><span class="line"><span class="comment">order</span></span><br><span class="line"><span class="comment">flex-grow</span></span><br><span class="line"><span class="comment">flex-shrink</span></span><br><span class="line"><span class="comment">flex-basis</span></span><br><span class="line"><span class="comment">flex</span></span><br><span class="line"><span class="comment">align-self</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*relative|fixed|static*/</span></span><br><span class="line"><span class="attribute">position</span>:absolute;</span><br></pre></td></tr></table></figure><p><code>relative</code>相对于自身，但是自己的位置依旧霸占着<br><code>fixed</code>相对于浏览器窗口<br><code>absolute</code>相对于离他最近的有定位的父元素<br><code>z-index很关键</code></p><h3 id="float布局"><a href="#float布局" class="headerlink" title="float布局"></a>float布局</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*right|none*/</span></span><br><span class="line"><span class="attribute">float</span><span class="selector-pseudo">:left</span>;</span><br></pre></td></tr></table></figure><h4 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h4><h4 id="闭合浮动"><a href="#闭合浮动" class="headerlink" title="闭合浮动"></a>闭合浮动</h4><h3 id="圣杯布局、双飞翼布局"><a href="#圣杯布局、双飞翼布局" class="headerlink" title="圣杯布局、双飞翼布局"></a>圣杯布局、双飞翼布局</h3><p>三栏布局，左右两边固定，中间自适应<br>浮动+负margin</p><h3 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h3><ul><li>Css3 Media Queries<br><code>max-width,min-width,max-device-width</code><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大于1200px的屏幕则这样子显示 */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>:<span class="number">1200px</span>)&#123; </span><br><span class="line">   <span class="selector-class">.style</span>  &#123;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#ccc</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>link里的media来指定使用条件<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel= &quot;stylesheet&quot;  media= &quot;only screen and (-webkit-min-device-pixel-ratio: <span class="number">2</span>)<span class="string">&quot;  type= &quot;</span>text/css<span class="string">&quot;  href= &quot;</span>style.css<span class="string">&quot;  /&gt;</span></span><br></pre></td></tr></table></figure></li><li>viewport<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; <span class="attribute">content</span>=&quot;<span class="attribute">width</span>=device-<span class="attribute">width</span>, initial-scale=<span class="number">1.0</span>&quot;&gt;</span><br></pre></td></tr></table></figure></li><li>使用百分比定义宽度、em定义字体大小</li></ul><h3 id="元素居中"><a href="#元素居中" class="headerlink" title="元素居中"></a>元素居中</h3><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><blockquote><p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">flex布局属性介绍</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flex </tag>
            
            <tag> float </tag>
            
            <tag> 前端 </tag>
            
            <tag> 布局 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test hexo</title>
      <link href="/one_hour/2018/02/05/test/"/>
      <url>/one_hour/2018/02/05/test/</url>
      
        <content type="html"><![CDATA[<ul><li>诞生日：2018&#x2F;02&#x2F;05<br><img src= "/one_hour/img/loading.gif" data-src="/one_hour/images/girl.jpeg" alt="image"></li></ul>]]></content>
      
      
      <categories>
          
          <category> test </category>
          
      </categories>
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
