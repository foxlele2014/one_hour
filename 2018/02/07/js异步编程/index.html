
<!DOCTYPE html>
<html lang="zh-CN">
    <!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
    <link rel="icon" href="/one_hour/img/favicon.png">
  
  
      <meta name="author" content="limin">
  
  
      <meta name="subtitle" content="After all,tomorrow is another day.">
  
  
      <meta name="description" content="无聊的博客">
  
  
  
    <link rel="alternate" href="/one_hour/atom.xml " title="一个博客" type="application/atom+xml">
  

  

  <title>js异步编程 | 一个博客</title>

  

  

  

  <link rel="stylesheet" href="/one_hour/css/style.css" >
  <link rel="stylesheet" href="/one_hour/css/partial/dark.css" >

  
  
  

  
    
      <link rel="stylesheet" href="/one_hour/css/partial/highlight/atom-one-light.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a2396837/CDN@latest/css/iconfont.css">
    
  

  
    <script src="/one_hour/js/todark.js"></script>
    
<meta name="generator" content="Hexo 6.3.0"></head>
</html>
    
<div class="nav index" style="height: 60px;">
    <div class="title animated fadeInDown">
        <div class="layui-container">
                <div class="nav-title"><a href="/one_hour/" title="一个博客">一个博客</a></div>
            <div class="nav-list">
                <button> <span class=""></span><span style="display: block;"></span><span class=""></span> </button>
                <ul class="layui-nav" lay-filter="">
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/one_hour/archives/ ">
                            <i class=" fas fa-archive " style="color: rgb(10 189 227);"></i>
                            <span class="layui-nav-item-name">归档</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/one_hour/tags/ ">
                            <i class=" fas fa-hashtag " style="color: rgb(254 202 87);"></i>
                            <span class="layui-nav-item-name">标签</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/one_hour/categories ">
                            <i class=" far fa-folder-open " style="color: rgb(29 209 161);"></i>
                            <span class="layui-nav-item-name">分类</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/one_hour/about ">
                            <i class=" fab fa-grav " style="color: rgb(154 106 247);"></i>
                            <span class="layui-nav-item-name">关于</span>
                        </a>
                    </li>
                    
                    
                        <li class="layui-nav-item" id="btn-toggle-dark">🌙</li>
                    
                    <span class="layui-nav-bar" style="left: 342px; top: 78px; width: 0px; opacity: 0;"></span>
                </ul>
            </div>
        </div>
    </div>
</div>
    
<header class="header">
        
            <div class="logo">
                    <a href="/one_hour/"><img src="https://github.com/foxlele2014/boring/assets/7221466/471fdf61-ccc9-4049-9c15-e035936329c3" onerror=this.onerror=null,this.src="/one_hour/img/loading.gif"></a>
            </div>
         
    </div>
     

            <div class="motto">
                <span>After all, tomorrow is another day.</span>
            </div>
    
    
            <div class="social">
                
                        <a class="social-icon" href="https://github.com/foxlele2014" target="_blank" title="Github">
                            <i class="iconfont icon-GitHub" aria-hidden="true"></i>
                          </a>
                 
                        <a class="social-icon" href="mailto:503275769@qq.com" target="_blank" title="Email">
                            <i class="iconfont icon-email" aria-hidden="true"></i>
                          </a>
                 
            </div>
     
</header>

    
<article id="post">
  <div class="post-title">js异步编程</div>
  
<div class="post-meta">
    
    
      <div class="post-meta-item date">
        <span title="发表于 2018.02.07"><i class="far fa-calendar-alt"></i> 2018.02.07</span>
      </div>
      <div class="post-meta-item updated">
        <span title="更新于 2025.01.17"><i class="far fa-calendar-check"></i> 2025.01.17</span>
      </div>
     
    
      <div class="post-meta-item categories">
        
          <i class="fas fa-inbox article-meta__icon"></i> <a href="/one_hour/categories/javascript/">javascript</a>
        
      </div>
     
    
     <div class="post-meta-item wordcount">
        
          <i class="fas fa-pencil-alt"></i> <span class="post-count">2.8k 字</span>
           
        
          <i class="far fa-clock"></i> <span class="post-count">12 分钟</span>
                               
      </div>
     
</div>


  
  <div class="content">
        <div><h3 id="计划内容"><a href="#计划内容" class="headerlink" title="计划内容"></a>计划内容</h3><ul>
<li>单线程</li>
<li>事件驱动</li>
<li>callback</li>
<li>setTimeout、setInterval</li>
<li>Promise</li>
<li>generator</li>
<li>async&#x2F;await</li>
</ul>
<h3 id="JavaScript的单线程特性"><a href="#JavaScript的单线程特性" class="headerlink" title="JavaScript的单线程特性"></a>JavaScript的单线程特性</h3><p>JavaScript是一门单线程的编程语言，这意味着它只有一个主线程来处理所有的任务。这种设计是由其最初在浏览器环境下的应用场景决定的。</p>
<h3 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a>事件驱动</h3><p>JavaScript通过事件驱动的方式来处理异步操作：</p>
<ul>
<li>事件循环（Event Loop）</li>
<li>事件队列（Event Queue）</li>
<li>宏任务（Macro-task）和微任务（Micro-task）</li>
</ul>
<h4 id="1-事件循环（Event-Loop）"><a href="#1-事件循环（Event-Loop）" class="headerlink" title="1. 事件循环（Event Loop）"></a>1. 事件循环（Event Loop）</h4><p>事件循环是JavaScript实现异步的核心机制，它主要负责：</p>
<ul>
<li>执行同步代码</li>
<li>检查宏任务队列</li>
<li>执行微任务队列</li>
<li>更新渲染</li>
</ul>
<p>执行顺序：</p>
<ol>
<li>执行同步代码（主线程）</li>
<li>清空微任务队列（micro-task queue）</li>
<li>执行一个宏任务（macro-task queue）</li>
<li>重复步骤2-3<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件循环示例</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>); <span class="comment">// 同步代码</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>); <span class="comment">// 宏任务</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>); <span class="comment">// 微任务</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>); <span class="comment">// 同步代码</span></span><br><span class="line"><span class="comment">// 输出顺序：1 -&gt; 4 -&gt; 3 -&gt; 2</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-事件队列（Event-Queue）"><a href="#2-事件队列（Event-Queue）" class="headerlink" title="2. 事件队列（Event Queue）"></a>2. 事件队列（Event Queue）</h4><p>JavaScript中有两种主要的任务队列：</p>
<ol>
<li><p><strong>宏任务队列（Macro-task Queue）</strong></p>
<ul>
<li>setTimeout&#x2F;setInterval</li>
<li>setImmediate (Node.js)</li>
<li>requestAnimationFrame (浏览器)</li>
<li>I&#x2F;O操作</li>
<li>UI渲染</li>
<li>script标签</li>
</ul>
</li>
<li><p><strong>微任务队列（Micro-task Queue）</strong></p>
<ul>
<li>Promise.then&#x2F;catch&#x2F;finally</li>
<li>process.nextTick (Node.js)</li>
<li>MutationObserver</li>
<li>queueMicrotask</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宏任务和微任务的执行顺序</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;宏任务1&#x27;</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微任务2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微任务1&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;宏任务2&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 输出顺序：微任务1 -&gt; 宏任务1 -&gt; 微任务2 -&gt; 宏任务2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="3-实际应用示例"><a href="#3-实际应用示例" class="headerlink" title="3. 实际应用示例"></a>3. 实际应用示例</h4><ol>
<li><strong>异步操作的优先级控制</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高优先级任务使用微任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">highPriorityTask</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;高优先级任务执行&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 低优先级任务使用宏任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">lowPriorityTask</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;低优先级任务执行&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>避免回调地狱的最佳实践</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不好的实践</span></span><br><span class="line"><span class="comment">// 回调地狱示例</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Promise改写</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用async/await改写（最优雅）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sequence</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line"><span class="title function_">sequence</span>();</span><br><span class="line"><span class="comment">// 好的实践</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">betterWay</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="4-注意事项"><a href="#4-注意事项" class="headerlink" title="4. 注意事项"></a>4. 注意事项</h4><ol>
<li><strong>性能考虑</strong></li>
</ol>
<ul>
<li>微任务优先级高，但不要过度使用</li>
<li>避免在微任务中执行耗时操作</li>
<li>合理使用宏任务分散负载</li>
</ul>
<ol start="2">
<li><p><strong>常见陷阱</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 死循环微任务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deadlock</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title function_">deadlock</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这会阻塞事件循环，导致宏任务无法执行</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>最佳实践</strong></p>
</li>
</ol>
<ul>
<li>耗时操作放入宏任务队列</li>
<li>需要即时响应的放入微任务队列</li>
<li>合理组合async&#x2F;await与Promise</li>
<li>避免同步阻塞操作</li>
</ul>
<h3 id="回调函数（Callback）"><a href="#回调函数（Callback）" class="headerlink" title="回调函数（Callback）"></a>回调函数（Callback）</h3><p>最基础的异步编程方式，但可能导致回调地狱：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调地狱示例</span></span><br><span class="line"><span class="title function_">getData</span>(<span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="title function_">getMoreData</span>(a, <span class="keyword">function</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    <span class="title function_">getMoreData</span>(b, <span class="keyword">function</span>(<span class="params">c</span>) &#123;</span><br><span class="line">      <span class="title function_">getMoreData</span>(c, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据获取完成&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="setTimeout和setInterval"><a href="#setTimeout和setInterval" class="headerlink" title="setTimeout和setInterval"></a>setTimeout和setInterval</h3><p>用于延时执行和周期性执行任务的定时器函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setTimeout示例</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;延时执行&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>Promise是一种更优雅的异步编程解决方案，可以有效避免回调地狱：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise示例</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;数据获取完成&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><p>生成器函数提供了一种可以暂停和恢复执行的方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dataGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> data1 = <span class="keyword">yield</span> <span class="title function_">getData</span>();</span><br><span class="line"><span class="keyword">const</span> data2 = <span class="keyword">yield</span> <span class="title function_">getMoreData</span>(data1);</span><br><span class="line"><span class="keyword">const</span> data3 = <span class="keyword">yield</span> <span class="title function_">getMoreData</span>(data2);</span><br><span class="line"><span class="keyword">return</span> data3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用生成器</span></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">dataGenerator</span>();</span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data1</span> =&gt;</span> &#123;</span><br><span class="line">  gen.<span class="title function_">next</span>(data1).<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data2</span> =&gt;</span> &#123;</span><br><span class="line">    gen.<span class="title function_">next</span>(data2).<span class="property">value</span>.<span class="title function_">then</span>(<span class="function"><span class="params">data3</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;最终数据:&#x27;</span>, data3);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="async-await"><a href="#async-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h3><p>async&#x2F;await是ES2017引入的一种更简洁的异步编程方式,它是Generator的语法糖:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async/await示例</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data1 = <span class="keyword">await</span> <span class="title function_">getData</span>();</span><br><span class="line">  <span class="keyword">const</span> data2 = <span class="keyword">await</span> <span class="title function_">getMoreData</span>(data1);</span><br><span class="line">  <span class="keyword">const</span> data3 = <span class="keyword">await</span> <span class="title function_">getMoreData</span>(data2);</span><br><span class="line">  <span class="keyword">return</span> data3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实践建议"><a href="#实践建议" class="headerlink" title="实践建议"></a>实践建议</h3><ol>
<li>优先使用async&#x2F;await进行异步编程</li>
<li>合理使用Promise.all()处理并发请求</li>
<li>注意错误处理和异常捕获</li>
<li>避免回调地狱</li>
<li>合理使用定时器，注意及时清除不需要的定时器</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JavaScript的异步编程经历了从回调函数、Promise、Generator到async&#x2F;await的演进过程，每种方式都有其适用场景：</p>
<ul>
<li>回调函数：简单场景</li>
<li>Promise：中等复杂度的异步操作</li>
<li>Generator：需要精细控制执行流程的场景</li>
<li>async&#x2F;await：复杂的异步流程控制</li>
</ul>
<h3 id="异步编程方案对比"><a href="#异步编程方案对比" class="headerlink" title="异步编程方案对比"></a>异步编程方案对比</h3><h4 id="1-回调函数（Callback）"><a href="#1-回调函数（Callback）" class="headerlink" title="1. 回调函数（Callback）"></a>1. 回调函数（Callback）</h4><p>优点：</p>
<ul>
<li>简单直接，容易理解</li>
<li>适用于简单的异步操作</li>
<li>基础代码量少</li>
</ul>
<p>缺点：</p>
<ul>
<li>容易产生回调地狱</li>
<li>错误处理复杂</li>
<li>代码可读性差</li>
<li>不能使用try-catch捕获错误</li>
</ul>
<p>适用场景：</p>
<ul>
<li>简单的一次性异步操作</li>
<li>事件监听处理</li>
</ul>
<h4 id="2-Promise"><a href="#2-Promise" class="headerlink" title="2. Promise"></a>2. Promise</h4><p>优点：</p>
<ul>
<li>链式调用，避免回调地狱</li>
<li>统一的错误处理机制</li>
<li>多个异步操作的状态管理</li>
<li>支持并行操作（Promise.all&#x2F;race）</li>
</ul>
<p>缺点：</p>
<ul>
<li>无法取消执行</li>
<li>无法获取执行进度</li>
<li>代码较callback略微复杂</li>
</ul>
<p>适用场景：</p>
<ul>
<li>多个依赖异步操作</li>
<li>需要错误统一处理</li>
<li>并行异步操作</li>
</ul>
<h4 id="3-Generator"><a href="#3-Generator" class="headerlink" title="3. Generator"></a>3. Generator</h4><p>默认执行之后会返回一个迭代器，<br>优点：</p>
<ul>
<li>可以暂停和恢复执行</li>
<li>提供了更好的异步流程控制</li>
<li>可以在生成器函数内部捕获错误</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要手动执行next()</li>
<li>代码较复杂</li>
<li>不直观，理解成本高</li>
</ul>
<p>适用场景：</p>
<ul>
<li>需要精确控制异步流程</li>
<li>需要实现迭代器</li>
<li>复杂的状态管理<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建自定义的迭代规则</span></span><br><span class="line"><span class="comment">// 创建一个范围迭代器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">range</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用迭代器</span></span><br><span class="line"><span class="keyword">const</span> iterator = <span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> value <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2状态机管理：</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">playerStateMachine</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">&#x27;IDLE&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(state) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;IDLE&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;等待操作&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;RUNNING&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;正在奔跑&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;JUMPING&#x27;</span>:</span><br><span class="line">                state = <span class="keyword">yield</span> <span class="string">&#x27;正在跳跃&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> player = <span class="title function_">playerStateMachine</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// &quot;等待操作&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>(<span class="string">&#x27;RUNNING&#x27;</span>).<span class="property">value</span>); <span class="comment">// &quot;正在奔跑&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(player.<span class="title function_">next</span>(<span class="string">&#x27;JUMPING&#x27;</span>).<span class="property">value</span>); <span class="comment">// &quot;正在跳跃&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 异步操作控制</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">dataFetchFlow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 显示加载状态</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">showLoading</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">yield</span> <span class="title function_">fetchData</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理数据</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">processData</span>(data);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 隐藏加载状态</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">hideLoading</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">handleError</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 工作流程控制</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">uploadProcess</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 检查文件</span></span><br><span class="line">    <span class="keyword">const</span> file = <span class="keyword">yield</span> <span class="string">&#x27;检查文件&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!file) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;文件不存在&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 压缩文件</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;压缩文件&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 上传</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="string">&#x27;上传中&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新界面</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;更新完成&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 表单验证流程</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">formValidation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 验证用户名</span></span><br><span class="line">    <span class="keyword">const</span> username = <span class="keyword">yield</span> <span class="string">&#x27;请输入用户名&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!username) <span class="keyword">yield</span> <span class="string">&#x27;用户名不能为空&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证密码</span></span><br><span class="line">    <span class="keyword">const</span> password = <span class="keyword">yield</span> <span class="string">&#x27;请输入密码&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (password.<span class="property">length</span> &lt; <span class="number">6</span>) <span class="keyword">yield</span> <span class="string">&#x27;密码太短&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证邮箱</span></span><br><span class="line">    <span class="keyword">const</span> email = <span class="keyword">yield</span> <span class="string">&#x27;请输入邮箱&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!email.<span class="title function_">includes</span>(<span class="string">&#x27;@&#x27;</span>)) <span class="keyword">yield</span> <span class="string">&#x27;邮箱格式错误&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;验证通过&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h4><ol>
<li>for of这里为啥没有使用next()?<br>可以手动使用next，也可以直接使用for of，Generator函数自动实现了迭代器协议，返回的对象自动实现Symbol.iterator方法;for of 循环内部自动调用next了;展开运算符；解构赋值；Array.from都会自动调用迭代器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for...of 循环内部大致相当于：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">forOf</span>(<span class="params">iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = iterator.<span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">while</span>(!result.<span class="property">done</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">value</span>);</span><br><span class="line">        result = iterator.<span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这些语法都会自动调用迭代器：</span></span><br><span class="line"><span class="keyword">const</span> numbers = [...<span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>)];  <span class="comment">// 展开运算符</span></span><br><span class="line"><span class="keyword">const</span> [a, b, c] = <span class="title function_">range</span>(<span class="number">1</span>, <span class="number">3</span>);     <span class="comment">// 解构赋值</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="title function_">range</span>(<span class="number">1</span>, <span class="number">5</span>));           <span class="comment">// Array.from</span></span><br></pre></td></tr></table></figure></li>
<li>Generator函数是为啥没有显式的return，但是却可以调用它的返回值？<br>Generator函数的隐式返回是Javascript引擎在调用时自动完成的，创建迭代器对象，设置内部状态，实现迭代器协议，返回这个迭代器对象。所以它总是会返回一个迭代器对象。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Generator函数的简化实现原理</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">simpleGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;开始执行&#x27;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;    <span class="comment">// 第一个暂停点</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;    <span class="comment">// 第二个暂停点</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;结束执行&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们调用Generator函数时，JavaScript引擎实际上会：</span></span><br><span class="line"><span class="comment">// 1. 创建一个迭代器对象</span></span><br><span class="line"><span class="comment">// 2. 设置初始状态</span></span><br><span class="line"><span class="comment">// 大致相当于以下代码：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建迭代器对象</span></span><br><span class="line">    <span class="keyword">const</span> iterator = &#123;</span><br><span class="line">        <span class="comment">// 内部状态</span></span><br><span class="line">        <span class="attr">_state</span>: <span class="number">0</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// next方法实现</span></span><br><span class="line">        <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span>(<span class="variable language_">this</span>.<span class="property">_state</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">_state</span> = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">_state</span> = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 实现迭代器协议</span></span><br><span class="line">        [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> iterator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>有什么更真实的场景会使用到状态机呢？（TODO: 还需要更深入的学习了解）<br>游戏角色的状态（初始化，攻击，受伤，死亡等），中间可以加入其他不是这几个的动作或者事件。（状态可以自动保存在闭包中，不需要额外的状态管理代码）其他的需要手动维护状态，保存和恢复需要显示编写。</li>
</ol>
<h4 id="使用Generator的关键考虑因素"><a href="#使用Generator的关键考虑因素" class="headerlink" title="使用Generator的关键考虑因素"></a>使用Generator的关键考虑因素</h4><ol>
<li>何时使用：</li>
</ol>
<ul>
<li>需要延迟计算</li>
<li>需要控制执行流程</li>
<li>需要自定义迭代逻辑</li>
<li>处理大量数据时需要分步处理</li>
</ul>
<ol start="2">
<li>何时不使用：</li>
</ol>
<ul>
<li>简单的异步操作（用async&#x2F;await更合适）</li>
<li>不需要暂停&#x2F;恢复的操作</li>
<li>团队对Generator不熟悉的情况</li>
</ul>
<ol start="3">
<li>注意事项：</li>
</ol>
<ul>
<li>Generator函数的错误处理需要特别注意</li>
<li>需要考虑内存使用（特别是无限序列）</li>
<li>调试可能比普通函数更复杂</li>
</ul>
<h4 id="4-Async-Await"><a href="#4-Async-Await" class="headerlink" title="4. Async&#x2F;Await"></a>4. Async&#x2F;Await</h4><p>优点：</p>
<ul>
<li>同步代码风格编写异步</li>
<li>简洁直观，易于理解</li>
<li>更好的错误处理机制</li>
<li>支持try-catch捕获异常</li>
<li>便于调试</li>
</ul>
<p>缺点：</p>
<ul>
<li>可能导致性能问题（如果使用不当）</li>
<li>无法处理取消操作</li>
<li>await会阻塞后续代码执行</li>
</ul>
<p>适用场景：</p>
<ul>
<li>复杂的异步业务逻辑</li>
<li>需要顺序执行的异步操作</li>
<li>依赖前一个异步结果的操作</li>
</ul>
<h4 id="如何取消异步操作"><a href="#如何取消异步操作" class="headerlink" title="如何取消异步操作"></a>如何取消异步操作</h4><p>如果是fetch请求，优先使用AbortController<br>如果需要精细控制，考虑Generator<br>如果是复杂的异步流程，考虑RxJS<br>如果是简单场景，可以使用自定义Promise</p>
</div>
        
  </div>

    <div class="post_tags">
      
        <i class="fas fa-tag"></i> <a href="/one_hour/tags/js/" class="tag">js</a>
      
        <i class="fas fa-tag"></i> <a href="/one_hour/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="tag">异步编程</a>
      
    </div>
    <div class="post-nav">
      
        <div class="post-nav-prev post-nav-item">
            <a href="/one_hour/2018/02/07/js%E5%8E%9F%E5%9E%8B%E9%93%BE/" >js原型链<i class="fa fa-chevron-left"></i></a>
        </div>
      
      
        <div class="post-nav-next post-nav-item">
            <a href="/one_hour/2018/02/07/js%E9%87%8C%E7%9A%84this/" >js里的this<i class="fa fa-chevron-right"></i></a>
        </div>
      
    </div>
      




</article>

    
<a id="gotop" href="javascript:" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    






    <div id="bottom-outer">
  <div id="bottom-inner">
    © 2025 <i class="fa fa-heart" id="heart"></i> limin
    <br />
    Powered by
    <a target="_blank" rel="noopener" href="http://hexo.io">hexo</a> | Theme is
    <a target="_blank" rel="noopener" href="https://github.com/a2396837/hexo-theme-blank/"
      >blank</a
    >
    
    <div class="icp-info">
      
      <a href="" target="_blank"> </a>
    </div>
    
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/layui-src@2.5.5/dist/layui.min.js"></script>



  
    <script src="/one_hour/js/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
  

 

  <script src="/one_hour/js/local-search.js"></script>
<script type="text/javascript">      
  var search_path = "search.xml";
if (search_path.length == 0) {
  search_path = "search.xml";
}
var path = "/one_hour/" + search_path;
  searchFunc(path, 'local-search-input', 'local-search-result');
</script>
  


  <script>
    window.lazyLoadOptions = {
      elements_selector: 'img',
      threshold: 0
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script>   
  


  <script>
    var images = $('img').not('.nav-logo img').not('.card img').not($('a>img')).not('.reward-content img')
    images.each(function (i, o) {
      var lazyloadSrc = $(o).attr('data-src') ? $(o).attr('data-src') : $(o).attr('src')
      $(o).wrap(`<a href="${lazyloadSrc}" data-fancybox="group" data-caption="${$(o).attr('alt')}" class="fancybox"></a>`)
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>
  <script>
        $().fancybox({
      selector: '[data-fancybox]',
      loop: true,
      transitionEffect: 'slide',
      protect: true,
      buttons: ['slideShow', 'fullScreen', 'thumbs', 'close']
    })
  </script>   
  










  <script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script>
  


  <script src="https://cdn.jsdelivr.net/gh/a2396837/CDN@latest/js/firework.js"></script>
  


  
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script>
<script>
!function (e, t, a) {
  var initCopyCode = function(){
    var copyHtml = '';
    copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
    copyHtml += '  <i class="fa fa-clipboard"></i><span>复制</span>';
    copyHtml += '</button>';
    $(".highlight .code pre").before(copyHtml);
    new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
  }
  initCopyCode();
}(window, document);
</script>  
  

<script>
  var btntop = $('#gotop');
  btntop.on('click', function (e) {
    e.preventDefault();
    $('html, body').animate({ scrollTop: 0 }, '300');
  });

  var $table = $('.content table').not($('figure.highlight > table'))
$table.each(function () {
  $(this).wrap('<div class="table-wrap"></div>')
})
</script>


</html>